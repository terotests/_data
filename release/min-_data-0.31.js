var testDataObjects_prototype=function(){"use strict";var t=function(){var t=function(){!function(t){var e,i,n,a,r;t.add=function(t,e,n){if(e||n){var a;"[object Array]"===Object.prototype.toString.call(n)?a=n:(a=Array.prototype.slice.call(arguments,2),a||(a=[])),i.push([e,t,a])}else i.push(t)},t.after=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),a[i]={step:Math.floor(1e3*t),fn:e,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),a[i]={step:Math.floor(1e3*t),fn:e,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!e){this.polyfill();var t,o;if("undefined"!=typeof window){var t=window.requestAnimationFrame,o=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(e){t||(t=window[e+"RequestAnimationFrame"],o=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),o||(o=function(t){clearTimeout(t)}),i=[],n={},a={},r=[];var s=0,c=function(){for(var e,o=(new Date).getTime();e=i.shift();)"[object Array]"===Object.prototype.toString.call(e)?e[1].apply(e[0],e[2]):e();for(var f=0;f<r.length;f++){var _=r[f];_()}for(var l in n)if(n.hasOwnProperty(l)){var d=n[l];d[0](d[1]),delete n[l]}for(var l in a)if(a.hasOwnProperty(l)){var d=a[l];d.nextTime<o&&(d.remove?d.nextTime>0?(d.fn(),delete a[l]):d.nextTime=o+d.step:(d.fn(),d.nextTime=o+d.step)),d.until&&d.until<o&&delete a[l]}t(c),s=o};c(),e=!0}}),t.once=function(t,e,i){n[t]=[e,i]},t.onFrame=function(t){r.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var e=r.indexOf(t);return e>=0?(t._onRemove&&t._onRemove(),r.splice(e,1),!0):!1}}(this)},i=function(t,e,n,a,r,o,s,c){if(!(this instanceof i))return new i(t,e,n,a,r,o,s,c);var f=[t,e,n,a,r,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=i._classInfo.name)return new _(t,e,n,a,r,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"later"},i.prototype=new t,"undefined"!=typeof window&&(window.later=i),"undefined"!=typeof window&&(window.later_prototype=t),function(t){t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.all=function(t){var i;i=this.isArray(t)?t:Array.prototype.slice.call(arguments,0);var n=i.length,a=0,r=[],o=new Array(n);return this.then(function(){var t=e();return 0==i.length&&t.resolve([]),i.forEach(function(e,i){e.then?(r.push(e),e.then(function(e){o[i]=e,a++,a==n&&t.resolve(o)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.collect=function(t,i,n){var a;a=this.isArray(i)?i:[i];var r=a.length,o=!1,s=!1,c=0,f=[],_=n||{};return this.then(function(){var i=e();return a.forEach(function(e){e.then?(f.push(e),e.then(function(e){c++,o=t(e,_),(o&&!s||0==s&&r==c)&&(i.resolve(_),s=!0)},function(t){i.reject(t)})):i.reject("Not list of promises")}),i})},t.fail=function(t){return this.then(null,t)},t.fulfill=function(t){if(!(this._rejected||this._fulfilled&&t!=this._stateValue)){this._fulfilled=!0,this._stateValue=t;for(var e=this._childPromises.length;e--;){var i=this._childPromises.shift();if(i._onFulfill)try{var n=i._onFulfill(t);"undefined"!=typeof n?i.resolve(n):i.fulfill(t)}catch(a){i.reject(a)}else i.fulfill(t)}this._state=1,this.triggerStateChange()}},t.genPlugin=function(t,i){this.plugin(t,function(){var t=Array.prototype.slice.call(arguments,0);console.log("Plugin args",t);var n=e();return this.then(function(){var e=Array.prototype.slice.call(arguments,0),a=t.concat(e),r=i.apply(this,a);n.resolve(r)},function(t){n.reject(t)}),n})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){if(this._state=0,this._stateValue=null,this._isAPromise=!0,this._childPromises=[],this.isFunction(t)&&(this._onFulfill=t),this.isFunction(e)&&(this._onReject=e),!e&&this.isFunction(t)){var n=this;i().asap(function(){console.log("--- calling the onFulfilled "),t(function(t){n.resolve(t)},function(t){n.resolve(t)})})}}),t.isFulfilled=function(){return 1==this._state},t.isPending=function(){return 0==this._state},t.isRejected=function(){return 2==this._state},t.nodeStyle=function(t,e){this.plugin(t,function(){var t,i,n=Array.prototype.slice.call(arguments,0),a=0;n.length>=0&&(t=n[n.length-1],"[object Function]"==Object.prototype.toString.call(t)&&(i=t,a=n.length-1));var r=wishes().pending();return this.then(function(){var t=wishes().pending(),o=Array.prototype.slice.call(arguments,0);console.log("Orig args",n),console.log("Then args",o);var s;0==n.length&&(s=o),0==o.length&&(s=n),s||(s=o.concat(n)),a=s.length,i&&a--,s[a]=function(e){if(e)return console.log("Got error ",e),t.reject(e),void r.reject(e);if(i){var n=Array.prototype.slice.call(arguments),a=i.apply(this,n);r.resolve(a)}else{var n=Array.prototype.slice.call(arguments,1);r.resolve.apply(r,n)}},t.then(function(t){r.resolve(t)}),console.log("nodeStyle after concat",s);e.apply(this,s);return t},function(t){r.reject(t)}),r})},t.onStateChange=function(t){this._listeners||(this._listeners=[]),this._listeners.push(t)},t.plugin=function(e,i){return t[e]=i,this},t.props=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push({name:i,promise:t[i]});var n=e.length,a=0,r=[],o={};return this.then(function(){var t=wishes().pending();return e.forEach(function(e){var i=e.promise,s=e.name;i.then?(r.push(i),i.then(function(e){o[s]=e,a++,a==n&&t.resolve(o)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.reject=function(t){if(!(this._fulfilled||this._rejected&&t!=this._rejectReason)){this._state=2,this._rejected=!0,this._rejectReason=t;for(var e=this._childPromises.length;e--;){var i=this._childPromises.shift();if(i._onReject)try{i._onReject(t),i.reject(t)}catch(n){i.reject(n)}else i.reject(t)}this.triggerStateChange()}},t.rejectReason=function(t){return t?void(this._rejectReason=t):this._rejectReason},t.resolve=function(t){if(!(this._state>0)){if(t==this)return this._rejectReason="TypeError",void this.reject(this._rejectReason);if(this.isObject(t)&&t._isAPromise){if(this._state=t._state,this._stateValue=t._stateValue,this._rejectReason=t._rejectReason,0===this._state){var e=this;t.onStateChange(function(){1==t._state&&e.resolve(t.value()),2==t._state&&e.reject(t.rejectReason())})}return 1==this._state&&this.fulfill(this._stateValue),void(2==this._state&&this.reject(this._rejectReason))}if(this.isObject(t)&&t.then&&this.isFunction(t.then)){var i=!1;try{var e=this;t.then.call(t,function(t){i||(e.resolve(t),i=!0)},function(t){i||(e.reject(t),i=!0)})}catch(n){i||this.reject(n)}}else this._state=1,this._stateValue=t,this.fulfill(t)}},t.state=function(t){return"undefined"!=typeof t&&(this._state=t),this._state},t.then=function(t,n){n||(n=function(){});var a=new e(t,n),r=this;return 1==this._state&&i().asap(function(){r.fulfill(r.value())}),2==this._state&&ater().asap(function(){r.reject(r.rejectReason())}),this._childPromises.push(a),a},t.triggerStateChange=function(){var t=this;this._listeners&&(this._listeners.forEach(function(e){e(t)}),this._listeners.length=0)},t.value=function(t){return"undefined"!=typeof t?(this._stateValue=t,this):this._stateValue}}(this)},e=function(t,i,n,a,r,o,s,c){if(!(this instanceof e))return new e(t,i,n,a,r,o,s,c);var f=[t,i,n,a,r,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=e._classInfo.name)return new _(t,i,n,a,r,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};e._classInfo={name:"_promise"},e.prototype=new t,"undefined"!=typeof window&&(window._promise=e),"undefined"!=typeof window&&(window._promise_prototype=t);var i=function(){!function(t){t.fromAce=function(t){var e=[];return t.forEach(function(t){var i=t.range;"insertText"==t.action&&e.push([1,i.start.row,i.start.column,i.end.row,i.end.column,t.text]),"removeText"==t.action&&e.push([2,i.start.row,i.start.column,i.end.row,i.end.column,t.text]),"insertLines"==t.action&&e.push([3,i.start.row,i.start.column,i.end.row,i.end.column,t.lines]),"removeLines"==t.action&&e.push([4,i.start.row,i.start.column,i.end.row,i.end.column,t.lines,t.nl])}),e},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.runToAce=function(t){var e=[],i=["","insertText","removeText","insertLines","removeLines"];return t.forEach(function(t){var n={action:i[t[0]],range:{start:{row:t[1],column:t[2]},end:{row:t[3],column:t[4]}}};t[0]<3?n.text=t[5]:n.lines=t[5],4==t[0]&&(n.nl=t[6]||"\n"),e.push(n)}),e},t.runToLineObj=function(t,e){e.forEach(function(e){var i=e[1],n=e[2],a=e[3],r=e[4];if(1==e[0])if("\n"==e[5]){var o=t.item(i);if(o){var s=o.text();o.text(s.slice(0,n));var c={text:s.slice(n)||""};t.insertAt(i+1,c)}else t.insertAt(i,{text:""}),t.insertAt(i+1,{text:""})}else{var o=t.item(i);if(o){var s=o.text();o.text(s.slice(0,n)+e[5]+s.slice(n))}else t.insertAt(i,{text:e[5]})}if(2==e[0])if("\n"==e[5]){var f=t.item(i),_=t.item(i+1),l="",d="";f&&(l=f.text()),_&&(d=_.text()),f?f.text(l+d):t.insertAt(i,{text:""}),_&&_.remove()}else{var o=t.item(i),s=o.text();o.text(s.slice(0,n)+s.slice(r))}if(3==e[0])for(var u=a-i,h=0;u>h;h++)t.insertAt(i+h,{text:e[5][h]});if(4==e[0])for(var u=a-i,h=0;u>h;h++){var o=t.item(i);o.remove()}})},t.runToString=function(t,e){if(!e||"undefined"==typeof t)return"";t+="";var i=t.split("\n");return e.forEach(function(t){var e=t[1],n=t[2],a=t[3],r=t[4];if(1==t[0])if("\n"==t[5]){var o=i[e]||"";i[e]=o.slice(0,n);var s=o.slice(n)||"";i.splice(e+1,0,s)}else{var o=i[e]||"";i[e]=o.slice(0,n)+t[5]+o.slice(n)}if(2==t[0])if("\n"==t[5]){var c=i[e]||"",f=i[e+1]||"";i[e]=c+f,i.splice(e+1,1)}else{var o=i[e]||"";i[e]=o.slice(0,n)+o.slice(r)}if(3==t[0])for(var _=a-e,l=0;_>l;l++)i.splice(e+l,0,t[5][l]);if(4==t[0])for(var _=a-e,l=0;_>l;l++)i.splice(e,1)}),i.join("\n")},t.simplify=function(t){var e,i=[],n=null;return t.forEach(function(t){e&&1==t[0]&&1==e[0]&&t[3]==t[1]&&e[1]==t[1]&&e[3]==t[3]&&e[4]==t[2]?n?(n[3]=t[3],n[4]=t[4],n[5]=n[5]+t[5]):(n=[],n[0]=1,n[1]=e[1],n[2]=e[2],n[3]=t[3],n[4]=t[4],n[5]=e[5]+t[5]):(n&&(i.push(n),n=null),1==t[0]?n=t.slice():i.push(t)),e=t}),n&&i.push(n),i}}(this)},r=function(t,e,i,n,a,o,s,c){if(!(this instanceof r))return new r(t,e,i,n,a,o,s,c);var f=[t,e,i,n,a,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=r._classInfo.name)return new _(t,e,i,n,a,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};r._classInfo={name:"aceCmdConvert"},r.prototype=new i,"undefined"!=typeof window&&(window.aceCmdConvert=r),"undefined"!=typeof window&&(window.aceCmdConvert_prototype=i);var o=function(){var t=function(){!function(t){t.run=function(t,e,i){if(t&&i&&4==t[0]){var n=t[1],a=e.data[n],r=i.value;r!=a&&(i.value=a)}}}(this)},i=function(t,e,n,a,r,o,s,c){if(!(this instanceof i))return new i(t,e,n,a,r,o,s,c);var f=[t,e,n,a,r,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=i._classInfo.name)return new _(t,e,n,a,r,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"_inputWorker"},i.prototype=new t;var n=function(){!function(t){t.run=function(t,e,i){if(t&&i){var n=i;if(this.bDetected||("undefined"!=typeof n.textContent?this.bFast=!0:(this.bFast=!1,this.tmpDom=document.createElement("div")),this.bDetected=!0),4==t[0]){var a=t[1],r=e.data[a];this.bFast?i.textContent=r:(this.tmpDom.innerHTML=r,i.innerHTML?i.innerHTML=this.tmpDom.innerText:i.replaceData(0,i.nodeValue.length,r||""))}}}}(this)},a=function(t,e,i,n,r,o,s,c){if(!(this instanceof a))return new a(t,e,i,n,r,o,s,c);var f=[t,e,i,n,r,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=a._classInfo.name)return new _(t,e,i,n,r,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};a._classInfo={name:"_domTextWorker"},a.prototype=new n;var o=function(){!function(t){var e,i,n,a,o,s,c,f,_;t._addCustomDir=function(t,e){s||(s={}),s[t]=e},t._addModelTemplate=function(t,i){var n=this.guid();e||(e={}),e[n]=i,t&&t.setAttribute&&t.setAttribute("data-tpl",n)},t._callCustom=function(t,e,i){s[t]&&s[t](e,i)},t._clearWorkers=function(t){t.workers.forEach(function(t){o._removeWorker(t)});var e=this;t.childViews.forEach(function(t){e._clearWorkers(t)})},t._createViewDef=function(t,e){var i={viewid:this.getGUID(),dataid:t,baseTpl:null,dom:null,parentView:e,workers:[],childViews:[]};return c||(c={}),c[i.viewid]=i,e&&e.childViews&&e.childViews.push(i),o._addModelView(t,i),i},t._eventActionFor=function(t,e,i){var n=t.target;if(n){var a=n.getAttribute(e),r=this;if(a){for(var o,s=10,c=n;c&&!(o=c.getAttribute("data-id"))&&s--;)c=c.parentNode;if(c&&o){var f=a.split("("),a=f.shift(),_=f.pop(),l=null;if(_)var d=_.split(")"),l=d.shift().split(",");var u=i.findFromCache(o);r.isFunction(u[a])&&(console.log("fires ",a,l),r.isArray(l)?u[a].apply(u,l):u[a]())}}}},t._findModelTemplate=function(t){if(t&&t.getAttribute){var i=t.getAttribute("data-tpl");if(e)return e[i]}},t._getNamedView=function(t){return a[t]},t._getNamedViews=function(){return a},t._getSvgTagName=function(t){return"textpath"==t?"textPath":t},t._getViewsOfModel=function(t){return e[t]},t._saveViewTemplate=function(t,e){i||(i={}),i[t]=e},t._setNamedModel=function(t,e){return n[t]=e,this},t._setNamedView=function(t,e){a[t]=e},t.clearTheView=function(t){if(c){var e=c[t];if(e){this._clearWorkers(e);var i=e.parentView;if(i){var n=i.childViews.indexOf(e);n>=0&&i.childViews.splice(n,1)}delete c[e.viewid]}}},t.composeModelView=function(t,e,i,n){var a,r=e,s=this,c=i.baseTpl;if(a=n?n:s._createViewDef(r.__id,i),c.classSwitch){var f,_=r.data[c.classSwitch];if(_?(f=c.classTemplates[_],f||(f=c.classTemplates["default"])):f=c.classTemplates["default"],f&&f){var l=s.composeTemplate(r,f,a);n?n.dom.parentNode.replaceChild(l,n.dom):t.appendChild(l),a.dom=l;var d=o._createWorker(r.__id,c.classSwitch,C().fetch(5),t,{view:a,template:c,m:r,dom:l});a.workers.push(d)}}else{var u=c.children[0],l=s.composeTemplate(r,u,i);t.appendChild(l),a.dom=l}},t.composePartsToTxt=function(t,e){for(var i="",n=t.txtParts.list,a=t.txtParts.tokens,r=0;r<n.length;r++){var o;if(o=a[r]){var s="";"undefined"!=typeof e.data[o]&&(s=e.data[o]||""),i+=s}else i+=n[r]||""}return i},t.composeTemplate=function(t,e,i){var n=!1,a=this;e&&e.tplData&&(e=e.tplData),e&&e.baseTpl&&(e=e.baseTpl);var r=!1;if(e.dataAttrs){{var c;e.dataAttrs["data-model-url"],e.dataAttrs["data-model-url-confirm"]}(c=e.dataAttrs["data-selection"])&&t.data[c]&&o._addSelectionModel(t.data[c]);var f=e.dataAttrs["data-use-model"];f&&o.query(f,function(e){e&&(t=e,r=!0)})}if(i){if(e.dataAttrs){var l=e.dataAttrs["data-view"];l&&(i=this._createViewDef(t.__id,i),i.baseTpl=e,this._setNamedView(l,i))}}else if(i=this._createViewDef(t.__id),i.baseTpl=e,e.dataAttrs){var l=e.dataAttrs["data-view"];l&&this._setNamedView(l,i)}if(3==e.type){var d;if(e.txtParts&&e.txtParts.bHas)for(var d=document.createDocumentFragment(),h=e.txtParts.list,v=e.txtParts.tokens,p=0;p<h.length;p++){var m;if(m=v[p]){var g="",y=!1,w=m.split(":");if(w.length>1){m=w[0];var b=w[1];if("aceHTML"==b){"undefined"!=typeof t.data[m]&&(g=t.data[m]||"");var I=document.createElement("div");I.setAttribute("class","aceHTML");var j=a.getAceInstance(t.__id+":"+m,I,t,m,null,i);j.dom.parentNode&&j.dom.parentNode.removeChild(j.dom),d.appendChild(j.dom),j.editor._noUpdates=!0,j.editor.setValue(g),j.editor._noUpdates=!1,i.workers.push(T),y=!0}if("aceJS"==b){"undefined"!=typeof t.data[m]&&(g=t.data[m]||"");var I=document.createElement("div");I.setAttribute("class","aceHTML");var j=a.getAceInstance(t.__id+":"+m,I,t,m,"javascript",i);j.dom.parentNode&&j.dom.parentNode.removeChild(j.dom),d.appendChild(j.dom),j.editor._noUpdates=!0,j.editor.setValue(g),j.editor._noUpdates=!1,y=!0}if("template"==b){"undefined"!=typeof t.data[m]&&(g=t.data[m]||"");var O=a.compile(g),x=a.composeTemplate(t,O);d.appendChild(x),y=!0;var A=a.getViewForElem(x),T=o._createWorker(t.__id,m,C().fetch(9),x,{modelid:t.__id,compiler:a,view:A});A.workers.push(T)}var R;if(_[b],(R=_[b])&&("this"==m?g=t:"undefined"!=typeof t.data[m]&&(g=t.data[m]||""),R.fn&&m)){var D=R.fn(g,{dom:d,data:t,tpl:e,view:i});if(D){d.appendChild(D),y=!0;var E=t.data[m];if(a.isObject(E)&&a.isArray(E.data))var T=o._createWorker(E.__id,"*",C().fetch(10),D,{modelid:E.__id,fn:R.fn,varName:m,dom:D,callOpts:{dom:d,data:E,tpl:e,view:i}});else{E=t;var T=o._createWorker(E.__id,m,C().fetch(10),D,{modelid:E.__id,fn:R.fn,varName:m,dom:D,callOpts:{dom:d,data:E,tpl:e,view:i}})}i.workers.push(T)}}}y||o.query(m,function(t,e){if(e){t||(t="");var n=document.createTextNode(t);if(d.appendChild(n),e.obj&&e.name){var a=o._createWorker(e.obj.__id,e.name,C().fetch(1),n,null);i.workers.push(a)}}},t)}else d.appendChild(document.createTextNode(h[p]||""))}else d=document.createTextNode(e.text||"")}if(1==e.type){var d,F=!1;if("svg"==e.tagName)d=document.createElementNS("http://www.w3.org/2000/svg","svg"),d.setAttribute("xmlns","http://www.w3.org/2000/svg"),d.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");else if("svg"==e.ns){var d=document.createElementNS("http://www.w3.org/2000/svg",this._getSvgTagName(e.tagName));d.setAttributeNS(null,"data-id",t.__id),d.setAttributeNS(null,"data-viewid",i.viewid)}else{var d=document.createElement(e.tagName);d.setAttribute("data-id",t.__id),d.setAttribute("data-viewid",i.viewid)}var S=!1;i.dom||(i.dom=d);var P,L;if(t&&(P=e.dataAttrs["data-sel-class"])){var k=P.split(":");L=k[0];var N=u().findSelection(L);N.indexOf(t.__id)>=0&&$(d).addClass(k[1])}var V=!1;if("style"==e.tagName){V=!0;var M=e.children[0],U={tpl:M,dom:d,model:t,modelid:t.__id},W=u()._createWorker(t.__id,"*",C().fetch(8),d,U);i.workers.push(W);var q=this.composePartsToTxt(M,t);d.cssText?d.cssText=q:a.dom_setText(d,q)}var H;if(t&&(H=e.dataAttrs["data-if-not-last"]))try{var J=t.__p;if(J){var G=o._find(J);if("undefined"!=typeof G){var B=G.data.indexOf(t),Q=G.data.length;Q-1>B||(d.style.display="none",n=!0)}}}catch(z){console.error(z.message)}if((H=e.dataAttrs["data-if"])&&o.query(H,function(e){e||(d.style.display="none");var n=o._createWorker(t.__id,H,C().fetch(11),d);i.workers.push(n)},t),(H=e.dataAttrs["data-if-not"])&&o.query(H,function(e){e&&(d.style.display="none");var n=o._createWorker(t.__id,H,C().fetch(11),d);i.workers.push(n)},t),H=e.dataAttrs["data-if-then"]){var X=H.split("=>"),Y=X[0].split("="),K=Y[0];o.query(K,function(t,e){var n=o._createWorker(e.obj.__id,e.name,C().fetch(13),d,{modelid:e.obj.__id,evalFn:H,thenCtrl:$.trim(X[1])});i.workers.push(n)},t)}if(!F){var Z;if(Z=e.dataAttrs["data-upload-to"])try{var te={vars:{},target:Z,autoUpload:!0,onComplete:function(t){console.log("***** GOT FROM UPLOAD "),console.log(t),o.execCommand(t)}},ee=e.dataAttrs["data-upload-list"];ee&&o.query(ee,function(t,e){console.log("---- upload list, to"),console.log(t),console.log(e),e.vars.responsesTo=e.obj.__id},t);var ie=o._createUploadFrame(te);d.appendChild(ie._dom)}catch(z){alert(z.message)}if(e.valueParts&&e.valueParts.bHas){for(var h=e.valueParts.list,v=e.valueParts.tokens,p=0;p<h.length;p++){var m;if(m=v[p]){var g="";o.query(m,function(t,n){if(n&&(t||(t=""),d.value=t,n.obj&&n.name)){var r=n.obj,s=n.name,c=o._createWorker(r.__id,s,C().fetch(2),d,null);i.workers.push(c),a.dom_setAttr(d,"data-value-id",r.__id+"::"+s,e.ns)}},t)}}S=!0}e.attributes&&e.attributes.forEach(function(n){var r=n[0],c=n[1],f=n[2];if("value"!=r||!S){var _=!1;if(s[r]){var l,u={},h={currentView:i,model:t,binds:f,name:r,vars:u,value:l};if(f)for(var v=f.list,p=f.tokens,m=0;m<v.length;m++){var g;if(g=p[m]){var y="";"undefined"!=typeof t.data[g]&&(y=t.data[g]||""),u[g]=y,h.vars=u,h.value=y;var w=o._createWorker(t.__id,g,C().fetch(6),d,h);i.workers.push(w)}}s[r](d,h)}if(e.dataAttrs[r]&&"data-attr-fwd"==r){var b=c.split(",");b.forEach(function(n){n=n.trim();var r="",s=n,c=n.split("=>");if(c.length>1&&(s=c[1].trim(),n=c[0].trim()),"undefined"!=typeof t.data[n]&&(r=t.data[n]||""),a.dom_setAttr(d,s,r,e.ns),"svg"==e.ns)var f=o._createWorker(t.__id,n,C().fetch(4),d,s);else var f=o._createWorker(t.__id,n,C().fetch(3),d,s);i.workers.push(f),_=!0})}if(f){var v=f.list,p=f.tokens;a.composeTokensToTxt(f,t,function(t){_=!0,a.dom_setAttr(d,r,t,e.ns)});for(var m=0;m<v.length;m++){var g;if(g=p[m]){var y="";if("undefined"!=typeof t.data[g]&&(y=t.data[g]||""),"svg"==e.ns)var w=o._createWorker(t.__id,g,C().fetch(4),d,{attrName:r,binds:f,compiler:a});else var w=o._createWorker(t.__id,g,C().fetch(3),d,{attrName:r,binds:f,compiler:a});i.workers.push(w),_=!0}}}_||a.dom_setAttr(d,r,c,e.ns)}})}if(e.children&&!V&&"textarea"!=e.tagName){var a=this;e.children.forEach(function(n){var r=n.dataAttrs["data-model"],s=n.dataAttrs["data-view"];if(r)o.query(r,function(t){if(t&&t.__id){if("svg"==n.ns)var r=document.createElementNS("http://www.w3.org/2000/svg",e.tagName);else var r=document.createElement(n.tagName);n.attributes.forEach(function(t){{var i=t[0],n=t[1];t[2]}a.dom_setAttr(r,i,n,e.ns)});var c=a._createViewDef(t.__id,i);if(c.dom=r,s&&a._setNamedView(s,c),a.dom_setAttr(r,"data-id",t.__id,e.ns),c.tagName=n.tagName,c.baseTpl=n,a.isArray(t.data)){var f=o._createWorker(t.__id,"*",C().fetch(7),c);c.workers.push(f),t.data.forEach&&t.data.forEach(function(t){a.composeModelView(r,t,c)}),d.appendChild(r)}else{var r=a.composeTemplate(t,n,c);r&&d.appendChild(r)}}},t);else{var c=a.composeTemplate(t,n,i);c&&d.appendChild(c)}})}}return n?d=document.createDocumentFragment():d},t.composeTokensToTxt=function(t,e,i){for(var n=t.list,a=t.tokens,r=[],s=0,c=!1,f=0;f<n.length;f++){var _;(_=a[f])?!function(t){o.query(_,function(e){e||(e=""),r[t]=e,s++,c||s!=n.length||(c=!0,i(r.join("")))},e)}(f):(r[f]=n[f]||"",s++)}c||s!=n.length||i(r.join(""))},t.createElemFromTpl=function(t,e){var i=this._findModelTemplate(t);console.log("Tpl",i);var n=i.cProp,a=i.baseTpl,r=e,o=this;if(!n){var s=o.createNewTemplate(r,a,t.tagName);return s}var c=i.classTpl;if(r.data[n]){var f=r.data[n],_=c[f];if(_){_=_.trim();var s=o.createNewTemplate(r,_,t.tagName);return s}}},t.createViewType=function(t,e,i){return _[t]?_[t].fn(e,i):void 0},t.findTemplateList=function(t){var e=t.split("{{"),i=e.length;if(2>i)return[t];for(var n=[],a=0;a<e.length;a++){var r=e[a];if(0!=r.length){var o=r.split("}}");o.length>1?(n.push("{{"+o[0]+"}}"),n.push(o[1])):n.push(r)}}return n},t.getAceInstance=function(t,e,i,n,a,s){if(a||(a="html"),f||(f={}),!f[t]){var c=ace.edit(e);c.setTheme("ace/theme/monokai"),c.getSession().setMode("ace/mode/"+a);c.getSession().on("change",function(t){if(!c._noUpdates){c._noUpdates=!0;for(var e,a=r(),s=r().fromAce([t.data]),f=a.simplify(s),_=[];e=f.pop();)_.push(e);o.execCommand([13,n,_,null,i.__id]),c._noUpdates=!1}});var _={dom:e,name:t,editor:c};f[t]=_;var l=o._createWorker(i.__id,n,C().fetch(12),e,{modelid:i.__id,editor:c,view:s});s.workers.push(l)}return f[t]},t.getGUID=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.getViewForElem=function(t){var e=t.getAttribute("data-viewid");return e?c[e]:void 0},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){n||(n={},a={},s={},_={},o=u())}),t.registerViewType=function(t,e){_[t]=e}}(this),function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isDataTrait=function(t){return t.__dataTr?!0:void 0},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){t.dom_setAttr=function(t,e,i,n){"xlink:href"==e?t.setAttributeNS("http://www.w3.org/1999/xlink","href",i):n?t.setAttributeNS&&t.setAttributeNS(null,e,i):t.setAttribute&&t.setAttribute(e,i)},t.dom_setText=function(t,e){if("undefined"!=typeof t.textContent)t.textContent=e;else{var i=document.createElement("div");i.innerHTML=e;var n=i.textContent||i.innerText||"";e.innerHTML=n}}}(this),function(t){var e,i;t.compile=function(t,e){var n,a={tagName:"DIV",tplData:null};if(e){var r=document.createElement(e);r.innerHTML=t,a.tagName=e,i[a.tagName.toLowerCase()]&&(n="svg")}else{var r=document.createElement("DIV");r.innerHTML=t}return a.tplData=this.parseNode(r,n),a},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(e=_e(),i={circle:"true",rect:!0,path:!0,svg:!0,image:!0,line:!0,text:!0,tspan:!0,g:!0,pattern:!0,polygon:!0,polyline:!0,clippath:!0,defs:!0,textpath:!0,feoffset:!0,femerge:!0,femergenode:!0,fegaussianblur:!0,filter:!0})}),t.parseMustache=function(t){var e=t.split("{{"),i=e.length;if(2>i)return[t];for(var n=[],a=0;a<e.length;a++){var r=e[a];if(0!=r.length){var o=r.split("}}");o.length>1?(n.push("{{"+o[0]+"}}"),n.push(o[1])):n.push(r)}}return n},t.parseNode=function(t,e){if(8==t.nodeType)return null;var n={tagName:t.tagName,type:t.nodeType,children:[],attributes:[],classTemplates:{},dataAttrs:{},ns:e};if(n.tagName){var a=n.tagName.toLowerCase();i[a]&&(e="svg","svg"!=a&&(n.ns="svg")),n.tagName=a}var r=!1;t.nodeName&&"input"==t.nodeName.toLowerCase()&&(r=!0);var o;if(r&&(o=t.getAttribute("data-input-value"))&&(n.value=o,n.valueParts=this.parseTemplateParts(o)),t.value&&!o&&(n.value=t.value,n.valueParts=this.parseTemplateParts(n.value)),t.attributes)for(var s=0;s<t.attributes.length;s++){var c=t.attributes[s];if(c.specified){var f=c.name,_=c.value;"data"==f.substring(0,4)&&(n.dataAttrs[f]=_),n.attributes.push([f,_,this.parseTemplateParts(_)])}}t.childNodes&&0!=t.childNodes.length||(n.text=t.textContent,n.txtParts=this.parseTemplateParts(n.text));var l=t.childNodes;if(l)for(var d=l.length,s=0;d>s;s++){var u=l[s],h=this.parseNode(u,e);h&&n.children.push(h)}var v;if(n&&(v=n.dataAttrs["data-class-switch"])){n.useClass=!0,n.classSwitch=v;for(var p=0;p<n.children.length;p++){var m=n.children[p];if(m.dataAttrs){var g=m.dataAttrs["data-class"];g&&(n.classTemplates[g]=m)}}}return n},t.parseTemplateParts=function(t){var e={list:null,tokens:{},bHas:!1};if(!t||0==t.length)return null;for(var i=e.list=this.parseMustache(t),n=0;n<i.length;n++){var a=i[n];if(a.length>3&&"{"==a.charAt(0)&&"{"==a.charAt(1)){e.bHas=!0;var r=a.substring(2,a.length-2);e.tokens[n]=r}}return e}}(this)},s=function(t,e,i,n,a,r,o,c){if(!(this instanceof s))return new s(t,e,i,n,a,r,o,c);var f=[t,e,i,n,a,r,o,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=s._classInfo.name)return new _(t,e,i,n,a,r,o,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};s._classInfo={name:"templateCompiler"},s.prototype=new o,"undefined"!=typeof window&&(window.templateCompiler=s),"undefined"!=typeof window&&(window.templateCompiler_prototype=o);var c=function(){!function(t){t.run=function(t,e,i,n){if(t&&i&&4==t[0]){{var a=n.attrName,r=n.binds,o=n.compiler;t[1]}console.log("ATTR CHANGE "),console.log("Binds ",r),console.log("DOM ATTR worker binds ",r);{r.list,r.tokens}o.composeTokensToTxt(r,e,function(t){console.log("Composed new attribute value for ",a),console.log(t),i.setAttribute(a,t)})}}}(this)},f=function(t,e,i,n,a,r,o,s){if(!(this instanceof f))return new f(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=f._classInfo.name)return new _(t,e,i,n,a,r,o,s)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};f._classInfo={name:"_domAttrWorker"},f.prototype=new c;var _=function(){!function(t){t.run=function(t,e,i,n){if(t&&i&&4==t[0]){var a=t[1],r=e.data[a];i.setAttributeNS(null,n,r)}}}(this)},l=function(t,e,i,n,a,r,o,s){if(!(this instanceof l))return new l(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=l._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};l._classInfo={name:"_svgAttrWorker"},l.prototype=new _;var d=function(){!function(t){t.run=function(t,e,i,n){if(t&&i&&4==t[0]){var a,r=n.view,o=n.m,c=n.template,f=o.data[c.classSwitch];if(f?(a=c.classTemplates[f],a||(a=c.classTemplates["default"])):a=c.classTemplates["default"],a&&a){var _=s();_._clearWorkers(r);var l=u(),d=r.dom.parentNode,h=_.composeTemplate(o,a,r);r.dom=h,d.replaceChild(h,n.dom);var v=l._createWorker(o.__id,c.classSwitch,C().fetch(5),h,{view:r,template:c,m:o,dom:h});r.workers.push(v)}}}}(this)},h=function(t,e,i,n,a,r,o,s){if(!(this instanceof h))return new h(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=h._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};h._classInfo={name:"_classWorker"},h.prototype=new d;var p=function(){!function(t){t.run=function(t,e,i,n){if(t&&i&&4==t[0]){var a=(n.tpl,n.binds),r=n.model,o=n.name,c=i,f={};if(a)for(var _=a.list,l=a.tokens,d=0;d<_.length;d++){var u;if(u=l[d]){var h="";"undefined"!=typeof r.data[u]&&(h=r.data[u]||""),f[u]=h,n.value=h}}n.vars=f,s()._callCustom(o,c,n)}}}(this)},m=function(t,e,i,n,a,r,o,s){if(!(this instanceof m))return new m(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=m._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};m._classInfo={name:"_customDirWorker"},m.prototype=new p;var g=function(){!function(t){t.run=function(t,e,i){if(t&&i){if(7==t[0]){var n=s();n.composeModelView(i.dom,e,i)}if(8==t[0]){var a=u(),e=a._find(t[2]),r=(a._find(t[4]),parseInt(t[2]),0),o=i.childViews.length;
for(console.log("Should remove ",e);o>r;r++){var c=i.childViews[r];if(c.dataid==t[2]){console.log("Found the view to be removed"),console.log(c),a._removeView(c);break}}}if(12==t[0]){var f,a=u(),e=a._find(t[1]),_=(a._find(t[4]),parseInt(t[2])),l=parseInt(t[3]),d=i.dom,h=d.children[l];f=h.parentNode,f.removeChild(h);var v=d.children[_];f.insertBefore(h,v),console.log("Moving the item ",i),console.log("Old "+l+" new "+_);var p=i.childViews.splice(l,1);console.log("theV ",p,p[0]),i.childViews.splice(_,0,p[0])}}}}(this)},y=function(t,e,i,n,a,r,o,s){if(!(this instanceof y))return new y(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=y._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};y._classInfo={name:"_listViewWorker"},y.prototype=new g;var w=function(){!function(t){var e;t.fetch=function(t){return e[t]},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(e=[null,a(),i(),f(),l(),h(),m(),y(),I(),O(),A(),R(),E(),S(),L()])})}(this)},C=function(t,e,i,n,a,r,o,s){if(!(this instanceof C))return new C(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=C._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};C._classInfo={name:"_workers"},C.prototype=new w;var b=function(){!function(t){t.run=function(t,e,i,n){if(t&&i&&4==t[0]){var a=n.tpl,r=n.model,o=i;r=u()._find(n.modelid);for(var s="",c=a.txtParts.list,f=a.txtParts.tokens,_=0;_<c.length;_++){var l;if(l=f[_]){var d="";"undefined"!=typeof r.data[l]&&(d=r.data[l]||""),s+=d}else s+=c[_]||""}o.cssText?o.cssText=s:o.textContent=s}}}(this)},I=function(t,e,i,n,a,r,o,s){if(!(this instanceof I))return new I(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=I._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};I._classInfo={name:"_rawTextWorker"},I.prototype=new b;var j=function(){!function(t){var e;t.run=function(t,i,n,a){if(t&&n&&4==t[0]){var r,o=a.compiler,s=t[1],c=t[2],f=n;r=u()._find(a.modelid);var _=o.compile(c),l=o.composeTemplate(r,_);o._clearWorkers(a.view),f.parentNode.replaceChild(l,f),e||(e=u());var d=o.getViewForElem(l),h=e._createWorker(r.__id,s,C().fetch(9),l,{modelid:r.__id,compiler:o,view:d});d.workers.push(h)}}}(this)},O=function(t,e,i,n,a,r,o,s){if(!(this instanceof O))return new O(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=O._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};O._classInfo={name:"_templateWorker"},O.prototype=new j;var x=function(){!function(t){t.run=function(t,e,i,n,a){if(t&&i){var r;r=a?a:n;var o,s=r.fn,c=r.callOpts,f=r.varName,_=r.dom;if(o=u()._find(r.modelid),_.parentNode){var l=s(o.data[f],{data:o,view:c.view,dom:_.parentNode});_.parentNode.replaceChild(l,_),r.dom=l}}}}(this)},A=function(t,e,i,n,a,r,o,s){if(!(this instanceof A))return new A(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=A._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};A._classInfo={name:"_abstractWorker"},A.prototype=new x;var T=function(){!function(t){t.run=function(t,e,i){if(t&&i){var n=i;if(4==t[0]){var a=t[1],r=e.data[a];if(r){var o=n.getAttribute("data-entry-class");n.style.display="block",o&&$(n).addClass(o);var s=n.getAttribute("data-exit-class");s&&$(n).removeClass(s)}else{var o=n.getAttribute("data-entry-class");o&&$(n).removeClass(o);var s=n.getAttribute("data-exit-class");s?($(n).addClass(s),setTimeout(function(){n.style.display="none"},500)):n.style.display="none"}}}}}(this)},R=function(t,e,i,n,a,r,o,s){if(!(this instanceof R))return new R(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=R._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};R._classInfo={name:"_domIfWorker"},R.prototype=new T;var D=function(){!function(t){t.run=function(t,e,i,n){if(t){if(4==t[0]){var a=n.editor,o=n.model;if(a._noUpdates);else{var s=u();s.isDoingRemote()||(console.log("Should update the ACE editor value directly here... "),a._noUpdates=!0,a.setValue(t[2],1),a._noUpdates=!1)}}if(13==t[0]){var a=n.editor,o=n.model;o=u()._find(n.modelid);var c=r().runToAce(t[2]);a._noUpdates=!0;var f=a.getSession(),_=f.getDocument();_.applyDeltas(c),a._noUpdates=!1}}}}(this)},E=function(t,e,i,n,a,r,o,s){if(!(this instanceof E))return new E(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=E._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};E._classInfo={name:"_aceEditorWorker"},E.prototype=new D;var F=function(){!function(t){t.run=function(t,e,i,n){if(t&&4==t[0]){{var a=i,r=u();r._find(n.modelid)}console.log("******* if Then Worker ******"),console.log(n),n.thenCtrl&&(console.log("==>Calling ctr"),r._callController(n.thenCtrl,n.modelid,a))}}}(this)},S=function(t,e,i,n,a,r,o,s){if(!(this instanceof S))return new S(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=S._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};S._classInfo={name:"_ifThenWorker"},S.prototype=new F;var P=function(){!function(t){t.run=function(t,e,i,n,a){if(t){if(4==t[0]){var r=u(),o=N();o.createPropertyUpdateFn(t[1],null);var s=r._find(n.modelid);if(s.__undone)return;n&&n.eventObj&&t[3]!=t[2]&&n.eventObj.trigger(t[1],t[2])}if(a){n=a}if(5==t[0]){var r=u(),s=r._find(t[2]),c=r._find(t[4]);if(s.__undone)return;if(c.__undone)return;var f=N();if(f.findFromCache(t[4])){var o=N(t[4]),_=N(t[2]),l=t[1];if(!o)return;if(!_)return;o[l]=_}}if(8==t[0]){var r=u(),s=r._find(t[2]);if(s.__undone)return;n.bListenMVC&&n.eventObj&&n.eventObj.trigger("remove",s.__removedAt)}if(7==t[0]){var r=u(),d=r._find(t[4]),h=r._find(t[2]);if(d.__undone)return;if(h.__undone)return;var v=d.data.indexOf(h);n.bListenMVC&&n.eventObj&&n.eventObj.trigger("insert",v)}if(12==t[0]){var r=u(),d=r._find(t[4]),v=parseInt(t[2]),p=d.data.length;if(d.__undone)return;for(var m=0;p>m;m++){var g=d.data[m];if(g.__id==t[1]){i=g;break}}if(i&&i.__undone)return;var y=i.__fromIndex;if(i){var w=parseInt(t[2]);n.bListenMVC&&n.eventObj&&n.eventObj.trigger("move",{from:y,to:w})}}}}}(this)},L=function(t,e,i,n,a,r,o,s){if(!(this instanceof L))return new L(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=L._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};L._classInfo={name:"_objectEventWorker"},L.prototype=new P;var k=function(){!function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this),function(t){var i,n,a,r,o;t.__dataTr=function(){},t._collectObject=function(t,e,i){this.isArray(e)||(e=e.split(","));var n={};e.forEach(function(e){n[e]=t[e](),t.on(e,function(){n[e]=t[e](),console.log(e+" = "+t[e]()+" from "+t.getID()),i(n)})}),i(n)},t._copyAs=function(t){var e=this,i=e._channelInfo;if(i){var n=this.toData();e._reGuidRawData(n);var a={ip:i.ip,port:i.port,sandbox:i.sandbox,path:i.path,file:t,createWith:n},r=N({},{channel:a});return r}},t._embedFileURL=function(t){var e=t||this._findURL(),i=this._parseURL(e),n=i.protocol+"://"+i.ip+":"+i.port+"/"+i.sandbox+"/"+i.path+"/"+this.getID()+".embed";return n},t._findActiveChannel=function(){if(this._activeChannel&&this._activeChannel)return this._activeChannel;var t=this.parent();return t?t._findActiveChannel():void 0},t._findRootDoc=function(){if(this._isRootDoc)return this;var t=this.parent();return t?t._findRootDoc():this},t._findURL=function(){for(var t=this;!t._docData.__radioURL;)t=t.parent();return t&&t._docData&&t._docData.__radioURL?t._docData.__radioURL:void 0},t._forMembers=function(t){var e=this;if(this.isArray())for(var i=0;i<this._data.length;i++){var n=this._data[i];this.isObject(n)&&n.__dataTr&&t(n)}else this._members.forEach(function(i){e[i]&&t(e[i])})},t._getCommandHistory=function(){return a._getCommandHistory(this._findURL())},t._initializeData=function(t,e){this._data=t.data,this._docData=t;var i=(a._createWorker(this._docData.__id,"*",C().fetch(14),null,{bListenMVC:!0,modelid:this._docData.__id,eventObj:this}),t.data);if(i instanceof Array)for(var n in i)this[n]=N(i[n]);else for(var n in i)if(i.hasOwnProperty(n)){var r=i[n];if(this.isFunction(r))continue;if(!this.isFunction(r)&&(r===Object(r)||r instanceof Array)){this[n]=new N(r,e);continue}this.isFunction(r)||this.isObject(r)||this.isArray(r)||this[n]||this.createPropertyUpdateFn(n,r)}},t._makeEmbeddable=function(){if(!this._docData.__p)return void console.error("ERROR: Can not make root document embeddable, it already is");if(this._docData.__rid)return void console.error("ERROR: The object is alrady remoted");var t=this._findURL(),e=N(this.serialize());e.then(function(){var i=e._metaFileURL(t),n=e._embedFileURL(t);console.log("Might be creting"),console.log("-",i),console.log("-",n);var a=N({});return void a.then(function(){console.log("The command list of this object "),console.log(a._docData.__ctxCmdList)})})},t._metaFileURL=function(t){var e=t||this._findURL(),i=this._parseURL(e),n=i.protocol+"://"+i.ip+":"+i.port+"/"+i.sandbox+"/"+i.path+"/"+this.getID()+".ln";return n},t._moveCmdListTo=function(t){if(this.__cmdList&&t){var e=t._findRootDoc();if(e){if(e.__cmdList||(e.__cmdList=[]),e.__ctxCmdList||(e.__ctxCmdList=[]),e==this)return;e.__cmdList.concat||(console.log("*cmdlist*"),console.log(JSON.stringify(e.__cmdList))),e.__cmdList=e.__cmdList.concat(this.__cmdList),this.__cmdList=[],e.__ctxCmdList=e.__ctxCmdList.concat(this.__ctxCmdList),this.__ctxCmdList=[]}}},t._parseURL=function(t){var e=t.split("://"),i=e.shift(),n=e.shift(),a=n.split("/"),r=a.shift(),o=r.split(":"),s=o[0],c=o[1],f=a.shift(),_=a.pop(),l=a.join("/");return{url:t,ip:s,port:c,sandbox:f,path:l,file:_,protocol:i}},t._reGuidRawData=function(t){if(console.log("_reGuidRawData"),this.isArray(t)){var e=this;t.forEach(function(t){e._reGuidRawData(t)})}else if(this.isObject(t))for(var i in t)t.hasOwnProperty(i)&&("__id"!=i?(this.isObject(t[i])&&this._reGuidRawData(t[i]),this.isArray(t[i])&&this._reGuidRawData(t[i])):(console.log("Changing the __id"),t[i]=this.guid()))},t._setAuthToken=function(t,e){n=t,i=e},t._setBroadcastManager=function(t){this.__bcManager=t},t.addController=function(t){this._controllers||(this._controllers=[]),this._controllers.indexOf(t)>=0||this._controllers.push(t)},t.askChannelQuestion=function(t,e,i){var n=this._findURL();console.log("Asking, the URL was "+n);var a=u(n);a.then(function(){console.log("Resolved the doc, asking the channel the question "+t),a._ask(t,e,i)})},t.at=function(t){var e=this._docData.data[t];return e?N(e):void 0},t.clear=function(){for(var t=this.length();t--;)this.pop()},t.clone=function(){return N(this.serialize())},t.copyToData=function(){var t=this.toData();return this._reGuidRawData(t),t},t.createArrayField=function(t,i){var n,r=this;n=i._docData?i:N(i);var o=e();return r.hasOwn(t)?(o.resolve(),this):(n.then(function(){a.execCommand([5,t,n.getID(),null,r.getID()]).then(function(){o.resolve()})}),r[t]=n,o)},t.createField=function(t,e){this.set(t,e||null)},t.createObjectField=function(t,i){var n,r=this;n=i._docData?i:N(i);var o=e();return r.hasOwn(t)?(o.resolve(!1),o):(n.then(function(){a.execCommand([5,t,n.getID(),null,r.getID()]).then(function(){o.resolve()})}),r[t]=n,o)},t.createPropertyUpdateFn=function(e,i){t[e]||(t[e]=function(t){if(this._docData){var i=this._docData.data;if(i){if("undefined"==typeof t)return i[e];if(i[e]!=t&&this._enterCtx(e))return a.execCommand([4,e,t,null,this._docData.__id]),this._leaveCtx(e),this}}},o[e]=!0)},t.dbDefineSync=function(t){if(t){var e=this;t.forEach(function(t){var i=e.dbFindSyncVar(t.name,!0);for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n])})}},t.dbFindSyncVar=function(t,e){this.__dbSync||(this.__dbSync=[]);for(var i=0;i<this.__dbSync.length;i++){var n=this.__dbSync[i];if(n.name==t)return n}if(e){var n={name:t,dirty:!1};this.__dbSync.push(n),this.on(t,function(){n.dirty=!0})}return n},t.dbSync=function(){for(var t=0;t<this.__dbSync.length;t++){var e=this.__dbSync[t];e.dirty&&e.syncFn&&(e.promises||(e.promises=[]),console.log("The variable ",e),e.promises.push(e.syncFn()),e.dirty=!1)}},t.emitValue=function(t,e){if(this._processingEmit)return this;if(this._processingEmit=!0,this._controllers)for(var i=0,n=0;n<this._controllers.length;n++){var a=this._controllers[n];a[t]&&(a[t](e),i++)}this._valueFn&&this._valueFn[t]&&this._valueFn[t].forEach(function(t){t(e)}),this._parent&&this._parent.emitValue&&this._parent.emitValue(t,e),this._processingEmit=!1},t.extendWith=function(e){for(var i in e){var n=e[i];this.isFunction(n)&&(t[i]=n)}},t.find=function(t){console.log("*** find with "+t);var e=a._getObjectInPath(t,this._docData);return e?N(e.__id):null},t.findRootDocup=function(){for(var t,e=this;t=e.parent();)e=t;return u(e._docData)},t.forEach=function(t){var i=e(),n=e(),a=[],r=this;return this.isFulfilled()?(r._docData.data.forEach(function(t){if(!t.__undone){var e=N(t);e.isFulfilled()&&a.push(e)}}),a.forEach(function(e){t(e)}),n.resolve(!0),n):(this.then(function(){r._docData.data.forEach(function(t){t.__undone||a.push(N(t))}),i.all(a).then(function(){r._docData.data.forEach(function(e){if(!e.__undone){var i=N(e);t(i)}}),n.resolve(!0)}),i.resolve(!0)}),n)},t.get=function(t){return this[t]?this.isFunction(this[t])?this[t]():this[t]:void 0},t.getID=function(){return this._docData.__id},t.getRemoteID=function(){return this._docData&&this._docData.__rid?this._docData.__rid:void 0},t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.hasOwn=function(t){return"undefined"!=typeof this._docData.data[t]?!0:!1},t.indexOf=function(){return a.indexOf(this._docData)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){a||(a=u({})),r||(r={},o={})}),t.insertAt=function(t,e){this.push(e);var i=this.at(this.length()-1);return a.moveItemToPos(i.getID(),t),this},t.isArray=function(t){return"undefined"==typeof t?this._docData&&this._docData.data?this.isArray(this._docData.data):!1:"[object Array]"===Object.prototype.toString.call(t)},t.isDataTrait=function(t){return t._docData?!0:void 0},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this._docData&&this._docData.data?this.isObject(this._docData.data):!1:t===Object(t)},t.item=function(t){var e=this._docData.data[t];return e?N(e):void 0},t.keys=function(t){for(var e in this._docData.data)t(e,this._docData.data[e],this._docData.data);return this},t.length=function(){return this._docData&&this._docData.data?this._docData.data.length:0},t.moveDown=function(){a.moveItemDown(this._docData.__id)},t.moveToIndex=function(t){a.moveItemToPos(this._docData.__id,t)},t.moveUp=function(){a.moveItemUp(this._docData.__id)},t.onValue=function(t,e){this._valueFn||(this._valueFn={}),this._valueFn[t]||(this._valueFn[t]=[]),this._valueFn[t].indexOf(e)<0&&this._valueFn[t].push(e)},t.parent=function(t){if("undefined"!=typeof t)return console.error("setting parent is not implemented"),this;if(this._docData){var t=this._docData.__p;return t?N(t):void 0}},t.pick=function(t){var e=v(),i=this;return this.then(function(){console.log("About to collect ",t),i._collectObject(i,t,function(t){console.log("Got "+t),e.pushValue(t)})}),e},t.pop=function(){var t=this.length();if(t){var e=this.at(t-1);return e.remove(),e}},t.push=function(t){var i=e();if(t.then){var n=this._docData;return t.then(function(){t=t._docData,a.push(n,t).then(function(){i.resolve(!0)})}),i}var r=this;return this.then(function(){a.push(r._docData,t).then(function(){i.resolve(!0)})}),i},t.pushRemote=function(t,e){if(this.isArray()){var i=this.guid();u().execCommand([16,t,e,i,this.getID()])}return this},t.remove=function(){return console.log("Removing cmd for ",this._docData.__id),a.removeItem(this._docData.__id),this},t.removeListener=function(t,e){if(this._events&&this._events[t]){var i=this._events[t].indexOf(e);i>=0&&this._events[t].splice(i,1),0==this._events[t].length&&delete this._events[t]}},t.renderTemplate=function(t){var e=s(),i=e.compile(t),n=e.composeTemplate(this._docData,i);return n},t.restackOps=function(t){function e(t,e,i,n,a){return{dist:t,data:e,from:i,to:n,parent:a}}function i(t){return t.reduce(function(t,e,i){return t+Math.abs(i-e)},0)}function n(t){var n=t.slice(0);console.log("data:",n);for(var o=n.length,s=o,c=i(n),f=[e(c,t,0,0,null)];c>0&&s>0;){var _=[];f.forEach(function(t){c=t.dist;for(var n=t.data,a=0;o>a;a++)for(var s=0;o+1>s;s++){var f=n.slice(0),l=f.splice(a,1);a>s?f.splice(s,0,l[0]):f.splice(s-1,0,l[0]);var d=i(f);if(_.length<r||c>d){var u=e(d,f,a,s,t);_.push(u),_.length>r&&(_.sort(function(t,e){return t.dist-e.dist}),_=_.slice(0,_.length-1)),c=_.reduce(function(t,e){return Math.max(t,e.dist)},0)}}}),f=_,s--,c=_.reduce(function(t,e){return Math.min(t,e.dist)},1)}if(_){for(var l=_.filter(function(t){return 0==t.dist})[0],d=[l];null!=l.parent;)d.push(l.parent),l=l.parent;return d.reverse(),d.slice(1).forEach(function(t){a.push(t.to==t.parent.data.length?["b",t.parent.data[t.from],t.parent.data[t.to-1]]:["a",t.parent.data[t.from],t.parent.data[t.to]])}),n}}var a=[],r=5;return n(t),a},t.restackOps2=function(t){function e(t){for(var e=t.slice(0),n=t.slice(0),a=t.slice(0).sort(function(t,e){return t-e}),r={},o={},s=0;s<n.length;s++){var c=a.indexOf(n[s]);r[n[s]]=c,o[c]=n[s],e[s]=c}var f=e.slice(0).sort(function(t,e){return t-e}),_=e[0],l=e[0],d=[],u=0,h=function(){var t=0;for(len=e.length,df=0;len>t;t++){var i=e[t];i>l&&(l=i),_>i&&(_=i),t>0&&d.push(f[t]-f[t-1]),t>0&&(u+=Math.abs(f[t]-f[t-1])),df+=Math.abs(i-f[t])}return u/=len,df/len}();d.sort(function(t,e){return t-e});for(var v=(d[0],function(t){for(var i=function(i,n,a){var r=[],o=e.length;for(n||(n=0);o>i;i++){var s=e[i];if(s-a!=1){var c=i+n;0>c&&(c=0),c>=o&&(c=o-1),t(s,f[c],s,a,i,o)&&(e[i+1]&&e[i+1]<s&&e[i+1]>a||(r.push(s),a=s))}else r.push(s),a=s}return r},n=[],a=0;.1>a;){for(var r=-5;5>=r;r++)n.push(i(Math.floor(e.length*a),r,_-1));a+=.05}return n.sort(function(t,e){return e.length-t.length}),n[0]}),p=[v(function(t,e,i,n,a,r){return n>i?!1:a>0&&Math.abs(i-n)>d[a-1]?!1:Math.abs(i-n)>h?!1:Math.abs(t-e)<=h*(a/r)&&i>=n?!0:Math.abs(n-i)<=h*(a/r)&&i>=n?!0:!1}),v(function(t,e,i,n,a,r){return n>i?!1:Math.abs(i-n)>h?!1:Math.abs(t-e)<=h*(a/r)&&i>=n?!0:Math.abs(n-i)<=h*(a/r)&&i>=n?!0:!1}),v(function(t,e,i,n,a,r){return n>i?!1:Math.abs(i-n)>h?!1:Math.abs(t-e)<=h*(a/r)&&i>=n?!0:Math.abs(n-i)<=h*(a/r)&&i>=n?!0:!1}),v(function(t,e,i,n,a,r){return n>i?!1:Math.abs(t-e)<=h*(a/r)&&i>=n?!0:Math.abs(n-i)<=h*(a/r)&&i>=n?!0:!1}),v(function(t,e,i,n,a,r){return n>i?!1:Math.abs(t-e)<=h&&i>=n?!0:Math.abs(n-i)<=h*(a/r)&&i>=n?!0:!1}),v(function(t,e,i,n){return n>i?!1:Math.abs(i-n)<u?!0:Math.abs(t-e)<=u&&i>=n?!0:!1}),v(function(t,e,i,n){return i>n?!0:!1}),v(function(t,e,i,n){return n>i?!1:Math.abs(i-n)>h?!1:Math.abs(t-e)<=h&&i>=n?!0:!1}),v(function(t,e,i,n,a,r){return n>i?!1:a>0&&Math.abs(i-n)>h?!1:Math.abs(t-e)<=h*(a/r)&&i>=n?!0:a>0&&Math.abs(n-i)<=h*(a/r)&&i>=n?!0:!1}),v(function(t,e,i,n){if(n>i)return!1;if(n>=_){if(i>=n)return!0}else if(i==_)return!0;return!1})],m=[],g=0,s=0;s<p.length;s++){var y=p[s];y.length>g&&(m=y,g=y.length)}0==m.length&&(m=[f[Math.floor(f.length/2)]]);{var w=[],C=[];!function(){var t=_,i=m[0],n=m.length,a=e.indexOf(i),r=0,o=0;for(len=e.length;len>o;o++){var s=e[o];s>=t&&i>=s&&a>=o?(w.push(s),t=s):C.push(s),s==i&&(t=s,n-1>r?(r++,i=m[r],a=e.indexOf(i)):(i=l,a=len+1))}}()}C.sort(function(t,e){return t-e});!function(){for(var t=0,e=0,n=w[0],a=C.length;a>t;){var r=w[e],s=C[t];if("undefined"==typeof r){for(;a>t;)i.push(["b",o[s],o[n]]),n=s,t++,s=C[t];return}s>r?(n=r,e++):(i.push(["a",o[s],o[r]]),t++)}}();return e}var i=[];return e(t),i},t.serialize=function(t){var e,i=this._docData.data;e=this.isArray(this._data)?[]:{};for(var n in i)if(i.hasOwnProperty(n)){var a=i[n];if("undefined"==typeof a)continue;if(t&&(this.isObject(a)||this.isArray(a)))continue;e[n]=this.isObject(a)?N(a).serialize():a}return e},t.set=function(t,i){var n=e();if(this.isFunction(i)){var r=this;return this.then(function(){return r.set(t,i(r.get(t)))})}if(this.isFulfilled())return a.execCommand([4,t,i,null,this._docData.__id]);var r=this;return o[t]||this.isObject(i)||this.createPropertyUpdateFn(t,i),this.then(function(){a.execCommand([4,t,i,null,r._docData.__id]).then(function(){n.resolve(!0)})}),n},t.toData=function(){var t=JSON.stringify(this._docData),e=JSON.parse(t);return e.__ctxCmdList&&delete e.__ctxCmdList,e.__cmdList&&delete e.__cmdList,e},t.toPlainData=function(){var t,e=this._docData.data;t=this.isArray(this._data)?[]:{};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if("undefined"==typeof n)continue;if(nonRecursive&&(this.isObject(n)||this.isArray(n)))continue;t[i]=this.isObject(n)?N(n).toPlainData():n}return t},t.unset=function(t){return a.unset(this._docData.__id,t),this},t.updateData=function(t){var e=this;if(t instanceof Array){var i=!0,n={};if(this.forEach(function(t){t.id?n[t.id()]=t:i=!1}),t.forEach(function(t){t.id||(i=!1)}),i)for(var a=0;a<t.length;a++){var r=t[a],o=n[r.id];o?o.updateData(r):e.push(r)}else console.log("Was not able to update data ",t);if(!i){e.clear();for(var s in t){var c=t[s];e.push(!this.isFunction(c)&&(c===Object(c)||c instanceof Array)?c:c)}}}else for(var s in t)if(t.hasOwnProperty(s)){var c=t[s];if(!(this.isFunction(c)||c instanceof Array||c!==Object(c)||c.constructor===Object))continue;!this.isFunction(c)&&(c===Object(c)||c instanceof Array)?this[s]?this[s].updateData&&this[s].updateData(c):(this[s]=new N(c),this[s].parent(this),this._members.push(s),this.saveCommand("setMember",s,this[s]._guid,null)):e[s]?e[s](c):(e.createPropertyUpdateFn(s,c),this[s](c))}},t.validatorFor=function(t,e){this._validators||(this._validators={}),this._validators[t]=e}}(this),function(t){var e;t._enterCtx=function(t){e||(e={active:{}}),this.__lid||(this.__lid=this.guid());var i=this.__lid+t;return e.active[i]?!1:(e.active[i]=1,!0)},t._getCtx=function(){var t={},i=e.active;for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);return t},t._leaveCtx=function(t){var i=this.__lid+t;e.active[i]&&delete e.active[i]},t._resetCtx=function(){e.active={}},t._setCtx=function(t){e.active=t},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this.__lid=this.guid(),e||(e={active:{}})})}(this),function(t){var e,i;t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(e=[]),i||(i=u())}),t.on=function(t,e){this._events||(this._events={}),this._events[t]||(this._events[t]=[]),this._events[t].push(e);var i=this;e._unbindEvent=function(){i.removeListener(t,e)}},t.removeListener=function(t,e){if(this._events&&this._events[t]){var i=this._events[t].indexOf(e);i>=0&&this._events[t].splice(i,1),0==this._events[t].length&&delete this._events[t]}},t.trigger=function(t,i){if(!(e.indexOf(t+this._guid)>=0)&&this._events&&this._events[t]){var n=this._events[t],a=this;e.push(t+this._guid);for(var r=n.length,o=0;r>o;o++)n[o](a,i);var s=e.indexOf(t+this._guid);e.splice(s,1)}}}(this),function(t){var e,i;t._askSnapshot=function(){var t=this.findRootDocup();t._askSnapshot(!0)},t._broadcastToCmdChannels=function(t){this._cmdChannels&&(console.log("Channels",this._cmdChannels),this._cmdChannels.forEach(function(e){e.broadcast(t)}))},t._clearCmdCache=function(){i={},e=[]},t._removeFromCache=function(t){return void console.error("_removeFromCache not implemented ")},t._sendToInListeners=function(){console.error("_sendToInListeners not implemented")},t.addToCache=function(t,e){i||(i={}),t&&(i[t]=e)},t.execCommands=function(){console.error("execCommands not implemented")},t.findFromCache=function(t){return i?i[t]:void 0},t.getObjectCache=function(){return i},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.isRecordingCommands=function(){console.error("isRecordingCommands not implemented")},t.saveCommand=function(){console.error("saveCommand not implemented")},t.setCommandRecOnOff=function(){console.error("setCommandRecOnOff not implemented")}}(this),function(t){var e,i,n;t._addFactoryProperty=function(t){i||(i=[]),i.push(t)},t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t){if(this.isObject(t)){if(t.data&&t.__id){var e=this.findFromCache(t.__id);if(e)return e}}else{var e=this.findFromCache(t);if(e)return e}if(i&&n)for(var a=0;a<i.length;a++){var r,o=i[a];if(t&&t.data?r=t.data[o]:t&&(r=t[o]),r&&(s=n[r]))return s}if(t&&t.__m){var r=t.__m,s=n[r];return s}}),t.callMe=function(t){alert(t)},t.createSubClass=function(t,e,i){var n=i,a=function(t,e,i,n,r,o,s,c){if(!(this instanceof a))return console.log("NOT instance of..."),new a(t,e,i,n,r,o,s,c);console.log("is instance of..."),console.log(this.__traitInit);var f=[t,e,i,n,r,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=a._classInfo.name)return new _(t,e,i,n,r,o,s,c)}else if(_)return _}if(this.__traitInit){console.log("Calling the subclass trait init...");var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};return a._classInfo={name:this.guid()},n.prototype=N.prototype,a.prototype=new n,this.registerComponent(e,a),this._addFactoryProperty(t),a},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i){e||(e=u({}));var n,a,r=this;if(!t)return void r.resolve(!0);if(t&&t.__id&&e._find(t.__id))return r._initializeData(t),r.addToCache(t.__id,r),void r.resolve(!0);if(t&&t.__rid){e._find(t.__rid)}a=u(t,i),a.then(function(){n=a.getData(),r._initializeData(n),r.addToCache(n.__id,r),r.resolve(!0)})}),t.registerComponent=function(t,e){n||(n={}),n[t]||(n[t]=e)}}(this)};k.prototype=e.prototype;var N=function(t,e,i,n,a,r,o,s){if(!(this instanceof N))return new N(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=N._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};N._classInfo={name:"_data"},N.prototype=new k,"undefined"!=typeof window&&(window._data=N),"undefined"!=typeof window&&(window._data_prototype=k),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},s=function(t,e,i,n,a,r,o,c){if(!(this instanceof s))return new s(t,e,i,n,a,r,o,c);var f=[t,e,i,n,a,r,o,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=s._classInfo.name)return new _(t,e,i,n,a,r,o,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};s._classInfo={name:"templatePackage"},s.prototype=new o,"undefined"!=typeof window&&(window.templatePackage=s),"undefined"!=typeof window&&(window.templatePackage_prototype=o);var c=function(){var t=function(){var t=function(){!function(t){var e,i,n,a,r;t.add=function(t,e,n){if(e||n){var a;"[object Array]"===Object.prototype.toString.call(n)?a=n:(a=Array.prototype.slice.call(arguments,2),a||(a=[])),i.push([e,t,a])}else i.push(t)},t.after=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),a[i]={step:Math.floor(1e3*t),fn:e,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),a[i]={step:Math.floor(1e3*t),fn:e,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!e){this.polyfill();var t,o;if("undefined"!=typeof window){var t=window.requestAnimationFrame,o=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(e){t||(t=window[e+"RequestAnimationFrame"],o=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),o||(o=function(t){clearTimeout(t)}),i=[],n={},a={},r=[];var s=0,c=function(){for(var e,o=(new Date).getTime();e=i.shift();)"[object Array]"===Object.prototype.toString.call(e)?e[1].apply(e[0],e[2]):e();for(var f=0;f<r.length;f++){var _=r[f];_()}for(var l in n)if(n.hasOwnProperty(l)){var d=n[l];d[0](d[1]),delete n[l]}for(var l in a)if(a.hasOwnProperty(l)){var d=a[l];d.nextTime<o&&(d.remove?d.nextTime>0?(d.fn(),delete a[l]):d.nextTime=o+d.step:(d.fn(),d.nextTime=o+d.step)),d.until&&d.until<o&&delete a[l]}t(c),s=o};c(),e=!0}}),t.once=function(t,e,i){n[t]=[e,i]},t.onFrame=function(t){r.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var e=r.indexOf(t);
return e>=0?(t._onRemove&&t._onRemove(),r.splice(e,1),!0):!1}}(this)},i=function(t,e,n,a,r,o,s,c){if(!(this instanceof i))return new i(t,e,n,a,r,o,s,c);var f=[t,e,n,a,r,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=i._classInfo.name)return new _(t,e,n,a,r,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"later"},i.prototype=new t,"undefined"!=typeof window&&(window.later=i),"undefined"!=typeof window&&(window.later_prototype=t),function(t){t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.all=function(t){var i;i=this.isArray(t)?t:Array.prototype.slice.call(arguments,0);var n=i.length,a=0,r=[],o=new Array(n);return this.then(function(){var t=e();return i.forEach(function(e,i){e.then?(r.push(e),e.then(function(e){o[i]=e,a++,a==n&&t.resolve(o)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.collect=function(t,i,n){var a;a=this.isArray(i)?i:[i];var r=a.length,o=!1,s=!1,c=0,f=[],_=n||{};return this.then(function(){var i=e();return a.forEach(function(e){e.then?(f.push(e),e.then(function(e){c++,o=t(e,_),(o&&!s||0==s&&r==c)&&(i.resolve(_),s=!0)},function(t){i.reject(t)})):i.reject("Not list of promises")}),i})},t.fail=function(t){return this.then(null,t)},t.fulfill=function(t){if(!(this._rejected||this._fulfilled&&t!=this._stateValue)){this._fulfilled=!0,this._stateValue=t,this._childPromises.forEach(function(e){if(e._onFulfill)try{var i=e._onFulfill(t);"undefined"!=typeof i?e.resolve(i):e.fulfill(t)}catch(n){e.reject(n)}else e.fulfill(t)}),this._childPromises=[],this._state=1,this.triggerStateChange()}},t.genPlugin=function(t,i){this.plugin(t,function(){var t=Array.prototype.slice.call(arguments,0);console.log("Plugin args",t);var n=e();return this.then(function(){var e=Array.prototype.slice.call(arguments,0),a=t.concat(e),r=i.apply(this,a);n.resolve(r)},function(t){n.reject(t)}),n})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){this._state=0,this._stateValue=null,this._isAPromise=!0,this._childPromises=[],this.isFunction(t)&&(this._onFulfill=t),this.isFunction(e)&&(this._onReject=e)}),t.isFulfilled=function(){return 1==this._state},t.isPending=function(){return 0==this._state},t.isRejected=function(){return 2==this._state},t.nodeStyle=function(t,i){this.plugin(t,function(){var t,n,a=Array.prototype.slice.call(arguments,0),r=0;a.length>=0&&(t=a[a.length-1],"[object Function]"==Object.prototype.toString.call(t)&&(n=t,r=a.length-1)),console.log("nodeStyle",a);var o=e();return this.then(function(){var t=e(),s=Array.prototype.slice.call(arguments,0);console.log("Orig args",a),console.log("Then args",s);var c;0==a.length&&(c=s),0==s.length&&(c=a),c||(c=s.concat(a)),r=c.length,n&&r--,c[r]=function(e){if(e)return console.log("Got error ",e),t.reject(e),void o.reject(e);if(n){var i=Array.prototype.slice.call(arguments),a=n.apply(this,i);o.resolve(a)}else{var i=Array.prototype.slice.call(arguments,1);o.resolve.apply(o,i)}},t.then(function(t){o.resolve(t)}),console.log("nodeStyle after concat",c);i.apply(this,c);return t},function(t){o.reject(t)}),o})},t.onStateChange=function(t){this._listeners||(this._listeners=[]),this._listeners.push(t)},t.plugin=function(e,i){return t[e]=i,this},t.props=function(t){var i=[];for(var n in t)t.hasOwnProperty(n)&&i.push({name:n,promise:t[n]});var a=i.length,r=0,o=[],s={};return this.then(function(){var t=e();return i.forEach(function(e){var i=e.promise,n=e.name;i.then?(o.push(i),i.then(function(e){s[n]=e,r++,r==a&&t.resolve(s)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.reject=function(t){if(!(this._fulfilled||this._rejected&&t!=this._rejectReason)){this._state=2,this._rejected=!0,this._rejectReason=t;this._childPromises.forEach(function(e){if(e._onReject)try{e._onReject(t),e.reject(t)}catch(i){e.reject(i)}else e.reject(t)}),this._childPromises=[],this.triggerStateChange()}},t.rejectReason=function(t){return t?void(this._rejectReason=t):this._rejectReason},t.resolve=function(t){if(!(this._state>0)){if(t==this)return this._rejectReason="TypeError",void this.reject(this._rejectReason);if(this.isObject(t)&&t._isAPromise){if(this._state=t._state,this._stateValue=t._stateValue,this._rejectReason=t._rejectReason,0===this._state){var e=this;t.onStateChange(function(){1==t._state&&e.resolve(t.value()),2==t._state&&e.reject(t.rejectReason())})}return 1==this._state&&this.fulfill(this._stateValue),void(2==this._state&&this.reject(this._rejectReason))}if(this.isObject(t)&&t.then&&this.isFunction(t.then)){var i=!1;try{var e=this;t.then.call(t,function(t){i||(e.resolve(t),i=!0)},function(t){i||(e.reject(t),i=!0)})}catch(n){i||this.reject(n)}}else this._state=1,this._stateValue=t,this.fulfill(t)}},t.state=function(t){return"undefined"!=typeof t&&(this._state=t),this._state},t.then=function(t,n){var a=new e(t,n),r=this;return 1==this._state&&i().asap(function(){r.fulfill(r.value())}),2==this._state&&i().asap(function(){r.reject(r.rejectReason())}),this._childPromises.push(a),a},t.triggerStateChange=function(){var t=this;this._listeners&&(this._listeners.forEach(function(e){e(t)}),this._listeners=[])},t.value=function(t){return"undefined"!=typeof t?(this._stateValue=t,this):this._stateValue}}(this)},e=function(t,i,n,a,r,o,s,c){if(!(this instanceof e))return new e(t,i,n,a,r,o,s,c);var f=[t,i,n,a,r,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=e._classInfo.name)return new _(t,i,n,a,r,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};e._classInfo={name:"_promise"},e.prototype=new t,"undefined"!=typeof window&&(window._promise=e),"undefined"!=typeof window&&(window._promise_prototype=t);var i=function(){!function(t){var e;t.createSocketServer=function(t){var i=t.ip+":"+t.port;if(e[i])return e[i];var n=r({url:"http://"+i+"/",ioOptions:{"reconnection delay":500,"reconnection limit":100,"max reconnection attempts":1/0}});return e[i]=n,n},t.genGUID=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(e={})})}(this)},n=function(t,e,i,a,r,o,s,c){if(!(this instanceof n))return new n(t,e,i,a,r,o,s,c);var f=[t,e,i,a,r,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=n._classInfo.name)return new _(t,e,i,a,r,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};n._classInfo={name:"_connectManager"},n.prototype=new i,"undefined"!=typeof window&&(window._connectManager=n),"undefined"!=typeof window&&(window._connectManager_prototype=i);var a=function(){!function(t){t.on=function(t,e){return this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(e),this},t.trigger=function(t,e,i){if(this._ev&&this._ev[t]){var n=this;return this._ev[t].forEach(function(t){t(n,e,i)}),this}}}(this),function(t){var e,i;t.createChannel=function(t,i){this._channels||(this._channels=[]),e||(e={});var n=t.sandbox+":"+t.path+":"+t.file;if(e[n])return e[n];var a=s(this,t,i);return e[n]=a,a},t.genGUID=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){console.log("_connSocket with ",t),this._socket=io.connect(t.url,t.ioOptions),this._options=t,this._connInfo={cnt:0,isConnected:!1};var e=this,i=this._socket;i.on("disconnect",function(){e._connInfo.isConnected=!1,e.trigger("disconnect")}),i.on("connect",function(){e._connInfo.isConnected=!0,e.trigger("connect")})}),t.localCmdBroadcast=function(t){console.log("Remote commands"),console.log(t),i._setCmdRemoteUpdate(!0),i.execCommands(t),i._setCmdRemoteUpdate(!1)},t.remoteCmdBroadcast=function(){}}(this)},r=function(t,e,i,n,a,o,s,c){if(!(this instanceof r))return new r(t,e,i,n,a,o,s,c);var f=[t,e,i,n,a,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=r._classInfo.name)return new _(t,e,i,n,a,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};r._classInfo={name:"_connSocket"},r.prototype=new a,"undefined"!=typeof window&&(window._connSocket=r),"undefined"!=typeof window&&(window._connSocket_prototype=a);var o=function(){!function(t){t.on=function(t,e){return this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(e),this},t.trigger=function(t,e,i){if(this._ev&&this._ev[t]){var n=this;return this._ev[t].forEach(function(t){t(n,e,i)}),this}}}(this),function(t){var e,i,n;t.addAnswerCallback=function(t,e,n){i||(i={}),i[t]={fn:e,cmd:n}},t.ask=function(t,e){t.__aid=this.genGUID(),e&&this.addAnswerCallback(t.__aid,function(n){e(n.answer),delete i[t.__aid]},t),console.log("Asking with "+t.__aid);var n=this.getSocket();n.emit("ask_"+this._channelId,t)},t.genGUID=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.getFileData=function(t){var e=this;e._tryCnt=0;var i,n=this.getSocket(),a=function(t){i=JSON.parse(t),n.removeListener("fileData_"+e._channelId,a)},r=function(a){var o=[];if(a.length>2)for(var s=a.split("\n"),c=s.length,f=0;c>f;f++){var _=s[f];!_||_.length<2||o.push(JSON.parse(_))}t(i,o),n.removeListener("changeData_"+e._channelId,r)};n.on("fileData_"+this._channelId,a),n.on("changeData_"+this._channelId,r),n.emit(this._channelId,{cmd:"getFile"})},t.getID=function(){return this._channelId},t.getSocket=function(){return this._socketObj._socket},t.getURL=function(){return this._url},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,a,r){var o=this,s=t._socket;this._socketObj=t,this._options=a,this._url=r,e||(e=u());var c=this.genGUID();this._options.responseId=c,o._tryCnt=0;var _=function(t){var c=t.channelId,_=t.namespace;n||(n={}),n[r]||(n[r]=_);var l=f();l.namespace(r,_),0==o._tryCnt&&(s.on("ctxupd_"+c,function(t){e._enterCtx(o._channelId)&&(t.forEach(function(t){e._setCtx(t.ctx),a.listeners.onCommand.forEach(function(e){e(t.cmd,t.ctx)}),e._resetCtx()}),e._leaveCtx(o._channelId))}),s.on("answer_"+c,function(t){if(i){var e=i[t.__aid];e&&e.fn(t)}})),o._channelId=c,o._isConnected=!0,o._tryCnt++,o.trigger("connect"),o.resolve(o._channelId)};s.on(c,_),s.connected?(console.log("Sending request for channel "),s.emit("requestChannel",o._options)):s.on("connect",function(){console.log("Sending request for channel "),s.emit("requestChannel",o._options)})})}(this)};o.prototype=e.prototype;var s=function(t,e,i,n,a,r,o,c){if(!(this instanceof s))return new s(t,e,i,n,a,r,o,c);var f=[t,e,i,n,a,r,o,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=s._classInfo.name)return new _(t,e,i,n,a,r,o,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};s._classInfo={name:"_connChannel"},s.prototype=new o,"undefined"!=typeof window&&(window._connChannel=s),"undefined"!=typeof window&&(window._connChannel_prototype=o),function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var i,a,r,o;t.ask=function(t,e,n,a){var r={cmd:e};a&&(r.data=a);var o=i[t];if(o){console.log("About to send question ",r);var o=o.channel;o&&o.ask(r,n)}},t.askPromise=function(t,e){var n=i[t];if(n){console.log("Creating ask promise");var a=_wish(),n=n.channel;return n&&n.ask(e,function(t){a.resolve(t)}),a}},t.command=function(t,n){var a={cmd:"cmd",data:n};return console.log("radio command called "),e(function(e,n){n("promise with : "+t);var r=i[t];r||n("no such channel : "+t);var r=r.channel;console.log("going to ask ",r),r&&r.ask(a,e)})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(i={},a={},r={},o=u())}),t.listen=function(t,a){var r=this.parseRemoteUrl(t),o=r.channel;o.listeners={onCommand:[]},a.onCommand&&o.listeners.onCommand.push(a.onCommand);var s=n().createSocketServer({ip:o.ip,port:o.port});a&&this.isObject(a)&&a.createWith&&(o.createWith=a.createWith),a&&this.isObject(a)&&a.dataNS&&(o.dataNS=a.dataNS);var c=e(),f=s.createChannel(o,t),_={channel:f,createdTime:(new Date).getTime(),bConnected:!1,bFileLoaded:!1,createOptions:o,listenerOptions:[]};return i[t]=_,_.listenerOptions.push(a),f.then(function(){_.bConnected=!0,f.getFileData(function(t,e){console.log("*********** CHANNEL ID ",f.getID());var i=_.listenerOptions;_.initData=t,_.initChanges=e;for(var n=0;n<i.length;n++){var a=i[n];a.onFile&&a.onFile(t,e,f.getURL())}_.bFileLoaded=!0,c.resolve(!0)})}),c},t.namespace=function(t,e){return"undefined"!=typeof e?(r[t]=e,this):r[t]||""},t.parseRemoteUrl=function(t){console.log("Parsing ",t);var e=t.split("://"),i=(e.shift(),e.shift()),n=i.split("/"),a=n.shift(),r=a.split(":"),o=r[0],s=r[1],c=n.shift(),f=n.pop(),_=n.join("/"),l={channel:{ip:o,port:s,sandbox:c,path:_,file:f,auth:{u:"abba",p:"nowp"}}};return l},t.send=function(t,e){if(i&&i[t]){var n=i[t].channel;if(n){if(!o._enterCtx(n._channelId))return;var a=n.getSocket();a.emit("ctxupd_"+n._channelId,e),o._leaveCtx(n._channelId)}}},t.snapshot=function(t,e){if(e){var n=i[t];if(n){var a={cmd:"snapshot"};a.rawData=e;var n=n.channel;n&&n.ask(a)}}}}(this)},f=function(t,e,i,n,a,r,o,s){if(!(this instanceof f))return new f(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=f._classInfo.name)return new _(t,e,i,n,a,r,o,s)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};f._classInfo={name:"docRadio"},f.prototype=new c,"undefined"!=typeof window&&(window.docRadio=f),"undefined"!=typeof window&&(window.docRadio_prototype=c);var _=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var i;t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t,e){return t===!1&&e?void 0:(i||(i={}),i[t]?i[t]:void(i[t]=this))}),t.addCommands=function(t,e){if(this.isArray(t)){var i=this;return t.forEach(function(t){i.addCommands(t)}),this}this._commands.push({fnCmd:t,fnFail:e,async:!0})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){this._commands||(this._commands=[],this.waitingList=[],this._index=0);var i=this;e||later().every(1/30,function(){i.step()})}),t.step=function(){var t=this._index,i=this._commands.length;if(t!=i){for(var n=e(),a=n,r=e(),o=this;i>t;){var s=this._commands[t];!function(t){a=a.then(function(){var i=e();return t.fnCmd(function(){i.resolve(!0)},function(e){i.resolve(!0),t.fnFail&&t.fnFail(e)}),i}).fail(function(e){t.fnFail&&t.fnFail(e)})}(s),this._index++,t++}return a.then(function(){if(o.waitingList.shift(),r.resolve(!0),o.waitingList.length){var t=o.waitingList[0];t.resolve(!0)}}).fail(function(){}),this.waitingList.push(n),1==this.waitingList.length&&n.resolve(!0),r}}}(this)},l=function(t,e,i,n,a,r,o,s){if(!(this instanceof l))return new l(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=l._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};l._classInfo={name:"sequenceStepper"},l.prototype=new _,"undefined"!=typeof window&&(window.sequenceStepper=l),"undefined"!=typeof window&&(window.sequenceStepper_prototype=_);var d=function(){!function(t){t.addController=function(t){this._controllers||(this._controllers=[]),this._controllers.indexOf(t)>=0||this._controllers.push(t)},t.clone=function(){return _data(this.serialize())},t.emitValue=function(t,e){if(this._processingEmit)return this;if(this._processingEmit=!0,this._controllers){for(var i=0,n=0;n<this._controllers.length;n++){var a=this._controllers[n];a[t]&&(a[t](e),i++)}if(this._processingEmit=!1,i>0)return this}this._valueFn&&this._valueFn[t]?this._valueFn[t](e):this._parent&&this._parent.emitValue&&this._parent.emitValue(t,e),this._processingEmit=!1},t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var i,n,o,s,c,f,_,l,d,h,v,p,m,g,y,w,C,b,I,j,O;t._addChannelFork=function(t,e){C[t]||(C[t]=[]),C[t].push(e)},t._addCommandChannel=function(t){return this._cmdChannels||(this._cmdChannels=[]),this._cmdChannels.indexOf(t)>=0?this:void this._cmdChannels.push(t)},t._addHotDoc=function(t){var e=h[t._guid];e?e.ms=(new Date).getTime():h[t._guid]={doc:t,ms:(new Date).getTime()}},t._addReflection=function(t,e){return t&&e&&t!=e?(y||(y={}),y[t]||(y[t]=[]),y[t].indexOf(e)<0&&y[t].push(e),this):this},t._ask=function(t,e,i){var n=this._data,a=n.__radio,r=n.__radioURL;e||(e={}),a.ask(r,t,i,e)},t._askSnapshot=function(){var t=this._data,e=t.__radio,i=t.__radioURL,t=this._transformObjFromNs(t);e.snapshot(i,t)},t._broadcastToCmdChannels=function(t){this._cmdChannels&&this._cmdChannels.forEach(function(e){e.broadcast(t)})},t._clearCmdCache=function(){n={},i=[]},t._createHotObject=function(t){var e=d.index[t._guid],i=this;return e?e.t=i._getCmdTime():(e={t:i._getCmdTime(),id:t._guid,o:t},t._hotBuffer=[],d.index[t._guid]=e,d.list.push(e)),e},t._debugMode=function(t){return"undefined"==typeof t?m.debugmode:(m.debugmode=t,this)},t._execCommandsPromise=function(t,i,n,a,r){for(var o=e(),s=e(),c=this,f=function(t,e){return t.then(function(){return i?c._realExecCmd(e,i,n,a,r):c.execCommand(e,i,n,a,r)})},_=t.length,l=o,d=0;_>d;d++)l=f(l,t[d]);return l.then(function(){s.resolve(!0)}),o.resolve(!0),s},t._findParentWithUrl=function(t){if(!t)return t;if(!t.__p)return t;if(t.__radioURL)return t;for(var e,i=t.__p,n=this._find(i);n;){if(n.__radioURL)return n;e=n,i=n.__p,n=this._find(i)}return e},t._findReflections=function(t){return y?y[t]:void 0},t._findRootDoc=function(t){if(!t.__p)return t;if(t.__virtual)return t;var e=t.__p,i=this._find(e);return i?this._findRootDoc(i):t},t._getCmdTime=function(){return d.time},t._getExecInfo=function(){return m},t._getNsFromUrl=function(t){return O[t]?O[t]:(I[j]=t,O[t]=j++,O[t])},t._getNsShorthand=function(t){return O[t]?O[t]:(I[j]=t,O[t]=j++,O[t])},t._getReflections=function(){return y},t._getReflectionsFor=function(t){if(y){var e=y[t];if(e)return e}return[]},t._getReverseNs=function(t){return I[t]},t._idFromNs=function(t){if(t){var e=t.length;"#"==t[e-1]&&(t=t.split("@").shift())}return t},t._idToNs=function(t,e){if(t){var i=t.length;if("#"==t[i-1]){var n=t.indexOf("@"),a=t.substring(n+1,i-1);a!=e&&(t=t.substring(0,n)+"@"+e+"#")}else t=t+"@"+e+"#"}return t},t._localExecCmd=function(t,i,n,a,o){var s=this,c=e();if(this.isArray(t[0]))return console.error("Array of promises NOT implemented.... "),c.resolve(!0),c;var f="local::"+t[0]+"::"+t[4];if(!s._enterCtx(f,!0))return c.resolve(!0),c;var l=(this._getExecInfo(),t.slice());if(!n){var d=this._find(t[4]);a=this._findParentWithUrl(d)}try{if(88==t[0]&&(this._pushChannelCommand(a.__radioURL,l.slice(),f,!1,a.__radio),c.resolve(!0)),1==t[0]){var h={data:{},__id:t[1]},v=this._getObjectHash();v[h.__id]=h,this.writeCommand(t),c.resolve(!0)}if(2==t[0]){var h={data:[],__id:t[1]},v=this._getObjectHash();v[h.__id]=h,this.writeCommand(t),c.resolve(!0)}if(3==t[0]&&c.resolve(!0),4==t[0]){var y=this._find(t[4]),w=t[1];if(y){if(!n&&y.__rid)return t[4]=y.__rid,s._leaveCtx(f),s._localExecCmd(t,i).then(function(){c.resolve(!0)}),c;if(t[3]||(t[3]=y.data[w],l[3]=y.data[w]),m.oldValue=y.data[w],y.data[w]=t[2],this._cmd(t,y,null),n||i||this._pushChannelCommand(a.__radioURL,l.slice(),f,!1,a.__radio),p){var C=y.__id+"::"+w,b=p[C];b&&b.forEach(function(e){e(y,t[2])})}if(!n)return s._leaveCtx(f),s._sendCmdToRefs(l,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}else c.resolve(!0)}if(13==t[0]){var y=this._find(t[4]),w=t[1];if(!n&&y.__rid)return t[4]=y.__rid,s._leaveCtx(f),s.execCommand(t,i).then(function(){c.resolve(!0)}),c;var I=r();y.data[w]=I.runToString(y.data[w],t[2]),g=i||_;var j=[4,w,y.data[w],null,t[4]];if(this._cmd(j,y,null),(i||_)&&this._cmd(t,y,null),g=!1,n||i||this._pushChannelCommand(a.__radioURL,l,f,!1,a.__radio),p){var C=y.__id+"::"+w,b=p[C];b&&b.forEach(function(t){t(y,y.data[w])})}if(!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}if(5==t[0]){var y=this._find(t[4]),w=t[1],O=this._find(t[2]);if(!y||!O)return s._leaveCtx(f),void c.resolve(!0);var x=y;if(!n&&x.__rid&&x.__rid!=t[4]){var A=t.slice();return A[4]=x.__rid,s._leaveCtx(f),s.execCommand(A,i).then(function(){c.resolve(!0)}),c}if(O=this._transformToNsBeforeInsert(O,y),y.data[w]=O,O.__p=y.__id,this._cmd(t,y,O),n||i||(this._pushCmdListToChannel(O,a,f),this._pushChannelCommand(a.__radioURL,t,f,!1,a.__radio)),!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}if(10==t[0]){var y=this._find(t[4]),w=t[1];if(console.log("*** unsetting property ****",w),!y||!w)return s._leaveCtx(f),void c.resolve(!0);var x=y;if(!n&&y.__rid)return t[4]=y.__rid,s._leaveCtx(f),s._localExecCmd(t,i).then(function(){c.resolve(!0)}),c;if(delete y.data[w],O&&(O.__oldp=x.__id,O.__p=null),this._cmd(t,y,O),n||i||this._pushChannelCommand(a.__radioURL,l,f,!1,a.__radio),!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}if(7==t[0]){var x=this._find(t[4]),T=this._find(t[2]),w="*",R=x.data.length;if(x&&T){if(!n&&x.__rid&&x.__rid!=t[4])return t[4]=x.__rid,s._leaveCtx(f),s.execCommand(t,i).then(function(){c.resolve(!0)}),c;if(T=this._transformToNsBeforeInsert(T,x),x.data.push(T),T.__p=x.__id,this._cmd(t,x,T),n||i||(this._pushCmdListToChannel(T,a,f),this._pushChannelCommand(a.__radioURL,l,f,!1,a.__radio)),!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}else c.resolve(!0)}if(8==t[0]){var x=this._find(t[4]),D=this._find(t[2]),w="*",R=x.data.indexOf(D);if(x&&D){var E=(x.__rid&&D.__rid,!0);if(D.__vpid&&D.__vpid!=D.__pid&&(E=!1),!n){if(E&&D.__rid&&x.__rid)return t[4]=x.__rid,t[2]=D.__rid,s._leaveCtx(f),s.execCommand(t,i).then(function(){c.resolve(!0)}),c;if(!E&&D.__rid&&x.__rid&&D.__vcid!=D.__id)return t[4]=D.__vpid,t[2]=D.__vcid,s._leaveCtx(f),s.execCommand(t,i).then(function(){c.resolve(!0)}),c}if(x.data.splice(R,1),D.__removedAt=R,this._cmd(l.slice(),x,D),n||i||this._pushChannelCommand(a.__radioURL,l,f,!1,a.__radio),D.__p=null,!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}else c.resolve(!0)}if(12==t[0]){var F,y=this._find(t[4]),w="*",S=y.data.length,P=0;for(P=0;S>P;P++){var L=y.data[P];if(L.__id==t[1]){F=L;break}}if(F){var k=parseInt(t[2]),N=this._find(t[1]),V=y.__rid&&N.__rid;if(!n&&V&&y.__rid!=y.__id)return N.__vpid&&N.__vpid!=t[4]?(t[4]=N.__vpid,t[1]=N.__vcid):(t[4]=y.__rid,t[1]=N.__rid),s._leaveCtx(f),s.execCommand(t,i).then(function(){c.resolve(!0)}),c;if(y.__fromIndex=P,F.__fromIndex=P,y.data.splice(P,1),y.data.splice(k,0,F),this._cmd(l,y,F),n||i||this._pushChannelCommand(a.__radioURL,l,f,!1,a.__radio),!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}else c.resolve(!0)}if(16==t[0]){console.log("%c COMMAND 16 ","background: #222; color: #bada55"),console.log(t);var M=this._find(t[4]),U=t[1],W=t[2],q=t[3],H=t[4];if(M&&M.data){if(!n&&M.__rid)return t[4]=M.__rid,s._leaveCtx(f),console.log(JSON.stringify(t)),s.execCommand(t,i).then(function(){c.resolve(!0)}),c;n||i||this._pushChannelCommand(a.__radioURL,l,f,!1,a.__radio),console.log(" - - - about to insert remote object into array - - - ");var J=this._find(W),G=this._find(q);console.log("Checking if the objects are already here..."),console.log("Remote object ",J),console.log("Local object ",G);var B=_data();console.log("Data find from cache, local ",B.findFromCache(q));var h,Q={data:{},__rid:W,__id:q,__undone:!0};s._waitingPromises||(s._waitingPromises=[]),s._waitingPromises.push(c),M.data.push(Q),Q.__radioURL=U,console.log("--- calling change to remote ---- ");var z=u()._changeToRemote(Q,U,W);z.then(function(e){delete Q.__undone,console.log("The raw data for the object was "),console.log(JSON.parse(JSON.stringify(Q)));s._find(q);Q.__p=H;s._find(W);Q.__p=H,n&&o?(Q.__vpid=o.__vpid,Q.__vcid=o.__vcid):(Q.__vpid=H,Q.__vcid=q),s._addReflection(Q.__vcid,Q.__id),h=_data(Q),h.then(function(){console.log("Did load remote object... the object is "),console.log(h),s._cmd([7,M.data.length,q,null,H],M,h),n?c.resolve(e):s._sendCmdToRefs(t,i).then(function(){c.resolve(e)})})}),i||_||console.log("Writing the command .... "),s._leaveCtx(f)}else c.resolve(!0)}}catch($){console.error($.message),s._leaveCtx(f),c.resolve($.message)}return s._leaveCtx(f),c},t._moveCmdListToParent=function(t){if(t.__ctxCmdList){var e=this._findRootDoc(t);if(e==t)return;e&&(e.__ctxCmdList||(e.__ctxCmdList=[]),e.__ctxCmdList=e.__ctxCmdList.concat(t.__ctxCmdList),delete t.__ctxCmdList)}},t._nsFromId=function(t){var e;if(t){t+="";var i=t.length;"#"==t[i-1]&&(e=t.split("@").pop(),e=e.split("#").shift())}return e},t._pushCmdListToChannel=function(t,e){var i;this.isObject(t)&&t.__ctxCmdList?(i=t.__ctxCmdList,delete t.__ctxCmdList):i=t;var n=this;i.forEach(function(t){n._pushChannelCommand(e.__radioURL,t.cmd,t.ctx,!1,e.__radio)})},t._realExecCmd=function(t,i,n,a,o){var s=this,c=e();if(this.isArray(t[0]))return this._execCommandsPromise(t,i).then(function(){c.resolve(!0)}),c;var f="realExec::"+t[0]+"::"+t[4];if(!s._enterCtx(f))return c.resolve(!0),c;var l=(this._getExecInfo(),t.slice());try{if(88==t[0]&&c.resolve(!0),1==t[0]){var d={data:{},__id:t[1]},h=this._getObjectHash();h[d.__id]=d,c.resolve(!0)}if(2==t[0]){var d={data:[],__id:t[1]},h=this._getObjectHash();h[d.__id]=d,c.resolve(!0)}if(3==t[0]&&c.resolve(!0),4==t[0]){var v=this._find(t[4]),y=t[1];if(v){if(!n&&v.__rid)return t[4]=v.__rid,s._leaveCtx(f),s.execCommand(t,i).then(function(){c.resolve(!0)}),c;if(m.oldValue=v.data[y],v.data[y]=t[2],this._cmd(t,v,null),p){var w=v.__id+"::"+y,C=p[w];C&&C.forEach(function(e){e(v,t[2])})}if(!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}else c.resolve(!0)}if(13==t[0]){var v=this._find(t[4]),y=t[1];if(!n&&v.__rid)return t[4]=v.__rid,s._leaveCtx(f),s.execCommand(t,i).then(function(){c.resolve(!0)}),c;var b=r();v.data[y]=b.runToString(v.data[y],t[2]),g=i||_;var I=[4,y,v.data[y],null,t[4]];if(this._cmd(I,v,null),(i||_)&&this._cmd(t,v,null),g=!1,p){var w=v.__id+"::"+y,C=p[w];C&&C.forEach(function(t){t(v,v.data[y])})}if(!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}if(5==t[0]){var v=this._find(t[4]),y=t[1],j=this._find(t[2]);if(!v)return;if(!j)return;var O=v;if(!n&&O.__rid&&O.__rid!=t[4]){var x=t.slice();return x[4]=O.__rid,s._leaveCtx(f),s.execCommand(x,i).then(function(){c.resolve(!0)}),c}if(v.data[y]=j,j.__p=v.__id,this._cmd(t,v,j),!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}if(10==t[0]){var v=this._find(t[4]),y=t[1];if(!v)return;if(!y)return;if(!n&&v.__rid)return t[4]=v.__rid,s._leaveCtx(f),s.execCommand(t,i).then(function(){c.resolve(!0)}),c;if(delete v.data[y],!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}if(7==t[0]){var O=this._find(t[4]),A=this._find(t[2]),y="*",T=O.data.length;if(O&&A){if(!n&&O.__rid)return t[4]=O.__rid,s._leaveCtx(f),s.execCommand(t,i).then(function(){c.resolve(!0)}),c;if(O.data.push(A),A.__p=O.__id,this._cmd(t,O,A),!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}else c.resolve(!0)}if(8==t[0]){var O=this._find(t[4]),R=this._find(t[2]),y="*",T=O.data.indexOf(R);if(O&&R&&R.__p==O.__id){var D=(O.__rid&&R.__rid,!0);if(R.__vpid&&R.__vpid!=R.__pid&&(D=!1),!n){if(D&&R.__rid&&O.__rid)return t[4]=O.__rid,t[2]=R.__rid,s._leaveCtx(f),s.execCommand(t,i).then(function(){c.resolve(!0)}),c;if(!D&&R.__rid&&O.__rid&&R.__vcid!=R.__id)return t[4]=R.__vpid,t[2]=R.__vcid,s._leaveCtx(f),s.execCommand(t,i).then(function(){c.resolve(!0)}),c}if(O.data.splice(T,1),R.__removedAt=T,this._cmd(l,O,R),R.__p=null,!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}else console.error("Could not find the removed object"),c.resolve(!0)}if(12==t[0]){var E,v=this._find(t[4]),y="*",F=v.data.length,S=0;for(S=0;F>S;S++){var P=v.data[S];if(P.__id==t[1]){E=P;break}}if(E){var L=parseInt(t[2]),k=this._find(t[1]),N=v.__rid&&k.__rid;if(!n&&N)return k.__vpid?(t[4]=k.__vpid,t[1]=k.__vcid):(t[4]=v.__rid,t[1]=k.__rid),s._leaveCtx(f),s.execCommand(t,i).then(function(){c.resolve(!0)}),c;if(m.fromIndex=S,v.__fromIndex=S,E.__fromIndex=S,v.data.splice(S,1),v.data.splice(L,0,E),this._cmd(l,v,E,{fromIndex:S}),!n)return s._leaveCtx(f),s._sendCmdToRefs(t,i).then(function(){c.resolve(!0)}),c;c.resolve(!0)}else c.resolve(!0)}if(16==t[0]){var V=this._find(t[4]),M=t[1],U=t[2],W=t[3],q=t[4];if(V&&V.data){console.log(" - - - about to insert remote object into array - - - ");var H=this._find(U),J=this._find(W);console.log("Checking if the objects are already here..."),console.log("Remote object ",H),console.log("Local object ",J);var d,G={data:{},__rid:U,__id:W,__undone:!0};
s._waitingPromises||(s._waitingPromises=[]),s._waitingPromises.push(c),V.data.push(G),G.__radioURL=M;var B=u()._changeToRemote(G,M,U);B.then(function(e){delete G.__undone;s._find(W);G.__p=q;s._find(U);G.__p=q,n&&o?(G.__vpid=o.__vpid,G.__vcid=o.__vcid):(G.__vpid=q,G.__vcid=W),s._addReflection(G.__vcid,G.__id),console.log("The data before _data()"),console.log(JSON.parse(JSON.stringify(G))),d=_data(G),d.then(function(){s._cmd([7,V.data.length,W,null,q],V,d),n?c.resolve(e):s._sendCmdToRefs(t,i).then(function(){c.resolve(e)})})}),i||_||console.log("Writing the command .... "),s._leaveCtx(f)}}}catch(Q){console.error(Q.message),s._leaveCtx(f),c.resolve(Q.message)}return s._leaveCtx(f),c},t._removeFromCache=function(t){if(t)if(this.isObject(t)){var e=t._guid;e&&(console.log("*** removing "+e),delete n[e])}else t&&(console.log("*** removing "+t),delete n[t]);else{this._forMembers(function(t){t&&t._removeFromCache()}),this._removeFromCache(this)}},t._sendCmdToRefs=function(t,i){var n=this,a=e(),r=!1;if(4==t[0]&&y){var o=y[t[4]];if(o&&o.length){m.reflection=!0,r=!0;var s=[];o.forEach(function(e){t[4]=e,s.push(t.slice())}),n._execCommandsPromise(s,i,!0).then(function(){m.reflection=!1,a.resolve(!0)})}}if(13==t[0]&&y){var o=y[t[4]];if(o&&o.length){m.reflection=!0,r=!0;var s=[];o.forEach(function(e){t[4]=e,console.log(JSON.stringify(t)),s.push(t.slice())}),n._execCommandsPromise(s,i,!0).then(function(){m.reflection=!1,a.resolve(!0)})}}if(7==t[0]&&y){var o=y[t[4]],c=t[2];if(o&&o.length){m.reflection=!0,r=!0;var s=[],f=[];if(o.forEach(function(e){var i=n._find(c),a=t.slice();a[4]=e;var r=n._createReflection(i);r.then(function(t){a[2]=t.__id,console.log(a),s.push(a)}),f.push(r)}),f.length){var _=e();_.all(f).then(function(){n._execCommandsPromise(s,i,!0).then(function(){m.reflection=!1,a.resolve(!0)})}),_.resolve(!0)}else a.resolve(!0)}}if((5==t[0]||10==t[0])&&y){var o=y[t[4]],c=t[2];if(o&&o.length){m.reflection=!0,r=!0;var s=[],f=[];if(o.forEach(function(e){var i=n._find(c),a=t.slice();a[4]=e;var r=n._createReflection(i);r.then(function(t){a[2]=t.__id,console.log(a),s.push(a)}),f.push(r)}),f.length){var _=e();_.all(f).then(function(){n._execCommandsPromise(s,i,!0).then(function(){m.reflection=!1,a.resolve(!0)})}),_.resolve(!0)}else a.resolve(!0)}}if(16==t[0]&&y){var o=y[t[4]];if(o&&o.length){m.reflection=!0;var l={__vcid:t[3],__vpid:t[4]};r=!0;var s=[];o.forEach(function(e){t[4]=e,t[3]=n.guid(),console.log(JSON.stringify(t)),s.push(t.slice())}),n._execCommandsPromise(s,i,!0,null,l).then(function(){m.reflection=!1,a.resolve(!0)})}}if(8==t[0]&&y){var o=y[t[2]];if(o&&o.length){m.reflection=!0,r=!0;var s=[];o.forEach(function(e){t[2]=e;var i=n._find(e);i&&i.__p&&(t[4]=i.__p,s.push(t.slice()))}),n._execCommandsPromise(s,i,!0).then(function(){m.reflection=!1,a.resolve(!0)})}}if(12==t[0]&&y){var o=y[t[1]];if(o&&o.length){m.reflection=!0,r=!0;var s=[];o.forEach(function(e){t[1]=e;var i=n._find(e);i&&i.__p&&(t[4]=i.__p,s.push(t.slice()))}),n._execCommandsPromise(s,i,!0).then(function(){m.reflection=!1,a.resolve(!0)})}}return r||a.resolve(!0),a},t._sendToInListeners=function(t){v&&v.forEach(function(e){e(t)})},t._setCmdRemoteUpdate=function(t){_=t},t._transformCmdFromNs=function(t,e){var i=b,n=t.slice(),a=i[t[0]],r=this;return a&&a.forEach(function(t){n[t]=r._idFromNs(n[t],e)}),n},t._transformCmdToNs=function(t,e){var i=b,n=t.slice(),a=i[t[0]],r=this;return a&&a.forEach(function(t){n[t]=r._idToNs(n[t],e)}),n},t._transformObjFromNs=function(t,e){if(t&&t.__id){t.__id=this._idFromNs(t.__id,e);for(var i in t.data)t.data.hasOwnProperty(i)&&this.isObject(t.data[i])&&this._transformObjFromNs(t.data[i],e)}return t},t._transformObjToNs=function(t,e){if(t&&t.__id){var i;if(t.__radioURL)var i=this._getNsShorthand(t.__radioURL);t.__rid||(e=i||e),t.__id=this._idToNs(t.__id,e),t.__p&&(t.__p=this._idToNs(t.__p,e));for(var n in t.data)t.data.hasOwnProperty(n)&&this.isObject(t.data[n])&&this._transformObjToNs(t.data[n],i||e)}return t},t._transformToNsBeforeInsert=function(t,e){var i=t.__ctxCmdList,n=this._nsFromId(e.__id);console.log(" _transformToNsBeforeInsert ");var a=this;return n?(console.log("Using namespace "+n),i.forEach(function(t){t.cmd=a._transformCmdToNs(t.cmd,n)}),t=a._transformObjToNs(t,n),t.__ctxCmdList=i,this._addToCache(t),t):t},t.addCommandListener=function(t){f=t},t.addListener=function(t,e){p||(p={});var i,n=t.split("."),a=n[0];n.length>1&&(i=n[1]);var r=this.fetch(a);if(r&&i){var o=r.__id+"::"+i;p[o]||(p[o]=[]),p[o].push(e)}},t.addToCache=function(t){n||(n={}),t._guid&&(n[t._guid]=t)},t.compressCmdBuffer=function(t){console.log(JSON.stringify(t));for(var e=t.length,i={},n=e-1;n>=0;n--){var a=t[n];if(4==a[0]){var r=a[1];i[r]?t.splice(n,1):i[r]=!0}}return t},t.execCommand=function(t,i,n,a,o){var s,c=this._find(t[4]),f=(t[0],t.slice()),a=this._findParentWithUrl(c),_="::"+t[0]+"::"+t[1];if(a&&a.__radioURL&&(s=a.__radioURL),s){var l=this._localExecCmd(t,i,n,a,o);return l}var d=e();if(1==t[0]){var h={data:{},__id:t[1]};this._addToCache(h),this.writeCommand(t),console.log("DID create the new object")}if(2==t[0]){var h={data:[],__id:t[1]};this._addToCache(h),this.writeCommand(t)}if(4==t[0]){var v=t[1];if(c&&(m.oldValue=c.data[v],c.data[v]=t[2],this._cmd(t,c,null),this.writeCommand(t),p)){var y=c.__id+"::"+v,w=p[y];w&&w.forEach(function(e){e(c,t[2])})}}if(13==t[0]){var v=t[1],C=r();c.data[v]=C.runToString(c.data[v],t[2]),g=!1;var b=[4,v,c.data[v],null,t[4]];if(this._cmd(b,c,null),this.writeCommand(t),p){var y=c.__id+"::"+v,w=p[y];w&&w.forEach(function(t){t(c,c.data[v])})}}if(5==t[0]){var v=t[1],I=this._find(t[2]);if(!c)return;if(!I)return;c.data[v]=I,I.__p=c.__id,this._cmd(t,c,I),this._moveCmdListToParent(I),this.writeCommand(t)}if(7==t[0]){var j=this._find(t[4]),O=this._find(t[2]),v="*",x=j.data.length;j&&O&&(j.data.push(O),O.__p=j.__id,this._cmd(t,j,O),this._moveCmdListToParent(O),this.writeCommand(t))}if(8==t[0]){var j=this._find(t[4]),A=this._find(t[2]),v="*",x=j.data.indexOf(A);j&&A&&(j.data.splice(x,1),A.__removedAt=x,this._cmd(t,j,A),A.__p=null,this.writeCommand(f))}if(10==t[0]){var c=this._find(t[4]),v=t[1];console.log("*** unsetting property ****",v),c&&v&&(delete c.data[v],this.writeCommand(t))}if(12==t[0]){var T,c=this._find(t[4]),v="*",R=c.data.length,D=0;for(D=0;R>D;D++){var E=c.data[D];if(E.__id==t[1]){T=E;break}}if(T){{var F=parseInt(t[2]);this._find(t[1])}m.fromIndex=D,c.__fromIndex=D,T.__fromIndex=D,c.data.splice(D,1),c.data.splice(F,0,T),this._cmd(t,c,T),this.writeCommand(f)}}if(16==t[0]){var S=this._find(t[4]),P=t[1],L=t[2],k=t[3],N=t[4];if(S&&S.data){var d=e(),h=_data({data:{},__id:k,__rid:L});V._waitingPromises||(V._waitingPromises=[]),V._waitingPromises.push(d),V._enterCtx(_),h.then(function(){S.data.push(h._docData),h._docData.__radioURL=P,delete h._docData.__ctxCmdList,delete h._docData.__cmdList;var e=u()._changeToRemote(h._docData,P,L);e.then(function(e){V._find(k);h._docData.__p=N,h._docData.__vpid=N,h._initializeData(h._docData);var a=_data(k);a.then(function(){V._cmd([7,S.data.length,k,null,N],S,a),n?d.resolve(e):V._sendCmdToRefs(t,i).then(function(){d.resolve(e)})})})}),this.writeCommand(t),V._leaveCtx(_)}else d.resolve(!0)}else d.resolve(!0);return d;var V,d,_,h,h,c,v,y,w,c,v,C,b,y,w,c,v,j,O,v,x,j,A,v,x,c,v,R,T,D,E,F,S,P,L,k,N,h},t.execCommandBackup=function(t,e){var i=this;if(this.isArray(t[0]))return void t.forEach(function(t){i.execCommand(t,e)});var n="::"+t[0]+"::"+t[1];if(i._enterCtx(n)){try{if(1==t[0]){var a={data:{},__id:t[1]},o=this._getObjectHash();o[a.__id]=a,e||_||this.writeCommand(t)}if(2==t[0]){var a={data:[],__id:t[1]},o=this._getObjectHash();o[a.__id]=a,e||_||this.writeCommand(t)}if(4==t[0]){var s=this._find(t[4]),c=t[1];if(s&&(s.data[c]=t[2],this._cmd(t,s,null),s.__rid||e||_||this.writeCommand(t),p)){var f=s.__id+"::"+c,l=p[f];l&&l.forEach(function(e){e(s,t[2])})}}if(13==t[0]){var s=this._find(t[4]),c=t[1],d=r();s.data[c]=d.runToString(s.data[c],t[2]),g=e||_;var u=[4,c,s.data[c],null,t[4]];if(this._cmd(u,s,null),e||_?this._cmd(t,s,null):this.writeCommand(t),g=!1,p){var f=s.__id+"::"+c,l=p[f];l&&l.forEach(function(t){t(s,s.data[c])})}}if(5==t[0]){var s=this._find(t[4]),c=t[1];if(setObj=this._find(t[2]),!s)return;if(!setObj)return;s.data[c]=setObj,setObj.__p=s.__id,this._cmd(t,s,setObj),this._moveCmdListToParent(setObj),e||_||this.writeCommand(t)}if(7==t[0]){var h=this._find(t[4]),v=this._find(t[2]),c="*",y=h.data.length;h&&v&&(h.data.push(v),v.__p=h.__id,this._cmd(t,h,v),this._moveCmdListToParent(v),e||_||this.writeCommand(t))}if(8==t[0]){var h=this._find(t[4]),w=this._find(t[2]),c="*",y=h.data.indexOf(w);h&&w&&(h.data.splice(y,1),w.__removedAt=y,this._cmd(t,h,w),w.__p=null,e||_||this.writeCommand(t))}if(12==t[0]){var C,s=this._find(t[4]),c="*",b=s.data.length,I=0;for(I=0;b>I;I++){var j=s.data[I];if(j.__id==t[1]){C=j;break}}if(C){var O=parseInt(t[2]);m.fromIndex=I,s.data.splice(I,1),s.data.splice(O,0,C),this._cmd(t,s,C),e||_||this.writeCommand(t)}}}catch(x){console.error(x.message)}i._leaveCtx(n),this._virtualCommand(t,e||_)}},t.execCommandBackup2=function(){var t=this,i=e();if(this.isArray(a[0]))return console.log("Array of promises.... "),this._execCommandsPromise(a,isRemote).then(function(){i.resolve(!0)}),i;var n="::"+a[0]+"::"+a[1];if(!t._enterCtx(n))return console.log("===> could not enter"),i.resolve(!0),i;console.log("*** execCommand ",a);this._getExecInfo();try{if(1==a[0]){var o={data:{},__id:a[1]},s=this._getObjectHash();s[o.__id]=o,isRemote||_||this.writeCommand(a),i.resolve(!0)}if(2==a[0]){var o={data:[],__id:a[1]},s=this._getObjectHash();s[o.__id]=o,isRemote||_||this.writeCommand(a),i.resolve(!0)}if(4==a[0]){var c=this._find(a[4]),f=a[1];if(c){if(!reflection&&c.__rid)return console.log("**** sending command to the reflected object **** "),a[4]=c.__rid,t._leaveCtx(n),t.execCommand(a,isRemote).then(function(){i.resolve(!0)}),i;if(m.oldValue=c.data[f],c.data[f]=a[2],this._cmd(a,c,null),c.__rid||isRemote||_||this.writeCommand(a),p){var l=c.__id+"::"+f,d=p[l];d&&d.forEach(function(t){t(c,a[2])})}if(!reflection)return t._leaveCtx(n),console.log("**** commands to the refs... **** "),t._sendCmdToRefs(a,isRemote).then(function(){console.log("**** ... commands to refs done. **** "),i.resolve(!0)}),i;console.log(".... looks like this was reflection??? "),i.resolve(!0)}else i.resolve(!0)}if(13==a[0]){var c=this._find(a[4]),f=a[1];if(!reflection&&c.__rid)return console.log("**** sending ACE update command to the reflected object **** "),a[4]=c.__rid,t._leaveCtx(n),console.log(JSON.stringify(a)),t.execCommand(a,isRemote).then(function(){i.resolve(!0)}),i;var h=r();c.data[f]=h.runToString(c.data[f],a[2]),g=isRemote||_;var v=[4,f,c.data[f],null,a[4]];if(this._cmd(v,c,null),isRemote||_?this._cmd(a,c,null):this.writeCommand(a),g=!1,p){var l=c.__id+"::"+f,d=p[l];d&&d.forEach(function(t){t(c,c.data[f])})}if(!reflection)return t._leaveCtx(n),t._sendCmdToRefs(a,isRemote).then(function(){i.resolve(!0)}),i;i.resolve(!0)}if(5==a[0]){var c=this._find(a[4]),f=a[1];if(setObj=this._find(a[2]),!c)return;if(!setObj)return;c.data[f]=setObj,setObj.__p=c.__id,this._cmd(a,c,setObj),this._moveCmdListToParent(setObj),isRemote||_||this.writeCommand(a),i.resolve(!0)}if(7==a[0]){var y=this._find(a[4]),w=this._find(a[2]),f="*",C=y.data.length;if(y&&w){if(console.log(" insert OK "),!reflection&&y.__rid)return console.log("**** sending INSERT to the reflected object **** "),a[4]=y.__rid,t._leaveCtx(n),console.log(JSON.stringify(a)),t.execCommand(a,isRemote).then(function(){i.resolve(!0)}),i;if(y.data.push(w),w.__p=y.__id,this._cmd(a,y,w),y.__rid||this._moveCmdListToParent(w),y.__rid&&console.log("Can not write command, because parent object has __rid"),y.__rid||isRemote||_||(console.log(" creating write "),this.writeCommand(a)),!reflection)return t._leaveCtx(n),t._sendCmdToRefs(a,isRemote).then(function(){i.resolve(!0)}),i;i.resolve(!0)}}if(8==a[0]){console.log("%c COMMAND 8 ","background: red; color: #bada55"),console.log("*** remove item command "),console.log(a);var y=this._find(a[4]),b=this._find(a[2]),f="*",C=y.data.indexOf(b);if(y&&b){var I=y.__rid&&b.__rid,j=!0;if(b.__vpid&&b.__vpid!=b.__pid&&(j=!1),!reflection){if(j&&b.__rid&&y.__rid)return console.log("**** sending remove command to the reflected object **** "),a[4]=y.__rid,a[2]=b.__rid,t._leaveCtx(n),console.log(JSON.stringify(a)),t.execCommand(a,isRemote).then(function(){i.resolve(!0)}),i;if(!j&&b.__rid&&y.__rid)return console.log("**** sending remove command to the reflected object **** "),a[4]=b.__vpid,a[2]=b.__rid,t._leaveCtx(n),console.log(JSON.stringify(a)),t.execCommand(a,isRemote).then(function(){i.resolve(!0)}),i}if(console.log("*** was able to find the object to remove "),y.data.splice(C,1),b.__removedAt=C,this._cmd(a,y,b),b.__p=null,I||isRemote||_||this.writeCommand(a),!reflection)return t._leaveCtx(n),a[2]=b.__rid,t._sendCmdToRefs(a,isRemote).then(function(){i.resolve(!0)}),i;i.resolve(!0)}}if(12==a[0]){var O,c=this._find(a[4]),f="*",x=c.data.length,A=0;for(A=0;x>A;A++){var T=c.data[A];if(T.__id==a[1]){O=T;break}}if(O){var R=parseInt(a[2]),D=this._find(a[1]),E=c.__rid&&D.__rid;if(!reflection&&E)return console.log("**** sending moveToIndex CMD to the reflected object **** "),a[4]=c.__rid,a[1]=D.__rid,t._leaveCtx(n),console.log(JSON.stringify(a)),i.resolve(!0),i;if(m.fromIndex=A,c.data.splice(A,1),c.data.splice(R,0,O),this._cmd(a,c,O),E||isRemote||_||this.writeCommand(a),!reflection)return t._leaveCtx(n),t._sendCmdToRefs(a,isRemote).then(function(){i.resolve(!0)}),i;i.resolve(!0)}}if(16==a[0]){console.log("%c COMMAND 16 ","background: #222; color: #bada55"),console.log(a);var F=this._find(a[4]),S=a[1],P=a[2],L=a[3],k=a[4];if(F&&F.data){if(!reflection&&F.__rid)return a[4]=F.__rid,t._leaveCtx(n),console.log(JSON.stringify(a)),t.execCommand(a,isRemote).then(function(){i.resolve(!0)}),i;console.log(" - - - about to insert remote object into array - - - ");var o=_data({data:{},__id:L,__rid:P});t._waitingPromises||(t._waitingPromises=[]),t._waitingPromises.push(i),o.then(function(){console.log("%c COMMAND 16, did NEW object ","background: #222; color: #bada55"),console.log(o._docData),F.data.push(o._docData),o._docData.__radioURL=S,delete o._docData.__ctxCmdList,delete o._docData.__cmdList;var e=u()._changeToRemote(o._docData,S,P);e.then(function(e){console.log("%c COMMMAND 16 a new object creation, loader promise Returned with ","background: #222; color: #bada55"),console.log(e),console.log("The object to be changed is now ",o);var n=t._find(L);console.log("From cache it is ",L),console.log(n),o._docData.__p=k,o._docData.__vpid=k,o._initializeData(o._docData);var r=_data(L);r.then(function(){t._cmd([7,F.data.length,L,null,k],F,r),reflection?i.resolve(e):t._sendCmdToRefs(a,isRemote).then(function(){i.resolve(e)})})})}),isRemote||_||(console.log("Writing the command .... "),this.writeCommand(a)),t._leaveCtx(n)}}}catch(N){console.error(N.message),i.resolve(N.message)}return t._leaveCtx(n),i},t.findFromCache=function(t){return n?n[t]:void 0},t.getCommands=function(){return i},t.getObjectCache=function(){return n},t.getSetvalCmd=function(t,e){if(c[t]||(c[t]={}),!c[t][e]){c[t][e]=[]}return c[t][e]},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){o||(this.initCmdIndex(),m={},w={},C={},j=1,b={1:[1],2:[1],4:[4],5:[2,4],7:[2,4],8:[2,4],10:[2,4],12:[4],13:[4],16:[3,4]},O={},I={})}),t.initCmdIndex=function(){o={},o.createObject=1,o.createArray=2,o.initProp=3,o.set=4,o.setMember=5,o.push=6,o.pushObj=7,o.removeItem=8,o.last=9,o.removeProperty=10,o.insertObjectAt=11,o.moveToIndex=12,s=[null,null,null,null,null],c={},l={},h={},d={time:(new Date).getTime(),list:[],index:{}},later().every(.05,function(){return})},t.isDoingRemote=function(){return g},t.isRecordingCommands=function(){return!this._isRecordCommandsOff},t.reverseCommand=function(t){var e=t.slice();return 4==t[0]&&(e[2]=t[3],e[3]=t[2]),e},t.saveCommand=function(t,e,n,a){if(i||(i=[]),!_){o||this.initCmdIndex();var r=o[t];if(r){var s=r+":"+e,c=this;if(c._enterCtx(s)){var l,d=this._guid;if(4==r){{this._createHotObject(this)}l=[],l[0]=r,l[1]=e,l[2]=n,l[3]=a,l[4]=this._guid}else l=[],l[0]=r,l[1]=e,l[2]=n,l[3]=a,l[4]=d;this._hotBuffer&&this._hotBuffer.push(l),f&&f(l);var u=this._findRootDoc();return u&&(u.__cmdList||(u.__cmdList=[]),u.__ctxCmdList||(u.__ctxCmdList=[]),u.__cmdList.push(l),u.__ctxCmdList.push({ctx:this._getCtx(),cmd:l}),this._addHotDoc(u)),c._leaveCtx(s),this}}}},t.setCommandRecOnOff=function(t){return this._isRecordCommandsOff=t?!1:!0,this},t.writeCommand=function(t,e){e||(e=this._find(t[4])),t[5]=(new Date).getTime();var i=this._findRootDoc(e),n=i;return n.__cmdList||(n.__cmdList=[]),n.__ctxCmdList||(n.__ctxCmdList=[]),n.__radio?void console.error("**** the RADIO should not be used with WRITE COMMAND ***** "):void n.__ctxCmdList.push({ctx:this._getCtx(),cmd:t})}}(this),function(t){var e,i;t._createContextVar=function(t){var e={};i||(i=this.guid());var n=i+""+t;return e[n]=1,e},t._enterCtx=function(t,n){e||(e={active:{}}),i||(i=this.guid());var a=i+t;return e.active[a]?n?!0:!1:(e.active[a]=1,!0)},t._getContextId=function(){return i},t._getCtx=function(){var t={},i=e.active;for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);return t},t._leaveCtx=function(t){var n=i+t;e.active[n]&&delete e.active[n]},t._resetCtx=function(){e.active={}},t._setCtx=function(t){e.active=t},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(i=this.guid()),e||(e={active:{}})})}(this),function(t){t.forEach=function(t,e,i){if(t){var a,r;if(i){if(!i._data)return;r=i.data[t],r&&(a=r.data)}else{if(!this._data)return;r=this._data.data[t],r&&(a=r.data)}if(a)if(this.isArray(a))for(var o=0,s=a.length;s>o;o++){var c=a[o];e(c)}else if(this.isObject(a))for(n in a)if(a.hasOwnProperty(n)){var c=a[n];e(c)}}}}(this),function(t){var e,i,n,a,r,o,s,c,f,_,l,d;t._callController=function(t,e,i){var n=t.split("/");if(t=n[0],n.shift(),console.log("Looking for '"+t+"' "),a&&a[t]){var r;if(console.log("Found it, data =  ",e),console.log(a),e){var r=this._find(e);a[t](r,i,n)}}},t._clickResponder=function(t){console.log("**** AT CLICK RESPONDER **** "),e||(e=templateCompiler());var i=(new Date).getTime();if(!(_.hasClick&&i-_.hasClick<80)){_.hasClick=(new Date).getTime();var r=this,o=e,c=t.target||t.srcElement;if(c){var l=c.getAttribute("data-click-pop"),u=!1;if(l){var h=r.findPushId(c);h&&r.popView(h)}var v=c.getAttribute("data-click-compile");if(v){var p=v.split("=>");console.log("Compiling",p);var m=p[0],g=p[1],y=c.getAttribute("data-id"),w=r._find(y);if(w&&m&&g){e||(e=templateCompiler());var o=e,r=this,C=o.compile(w.data[m]);r.set(w,g,JSON.stringify(C));var b=JSON.stringify(templateCompiler2().compile(w.data[m]));console.log(b),console.log("LENGTH",b.length),console.log("HTML size",w.data[m].length),console.log("Orig data size",JSON.stringify(C).length)}}var v=c.getAttribute("data-click-set");if(v){var p=v.split("="),I=p[0],j=p[1],y=c.getAttribute("data-id"),w=r._find(y);r.query(I,function(t,e){var i=e.obj,n=e.name;console.log("Calling set for ",i,n),i.data[n]!=j&&r.set(i,n,j)},w)}var v=c.getAttribute("data-click-clear");if(v){var O=v.split(",");O.forEach(function(t){var e=c.getAttribute("data-id"),i=r._find(e);r.set(i,t,"")})}var v=c.getAttribute("data-toggle-this");if(v){var p=v.split("/");console.log("Data Toggle This ",p);var I=p[0],x=p[1],A=p[2],y=c.getAttribute("data-id"),w=r._find(y);console.log("Calling set for ",w),w.data[I]!=x?r.set(w,I,x):r.set(w,I,A)}var v=c.getAttribute("data-toggle-sublevels");if(v){var p=v.split("/"),v=p[0],I=p[1],x=p[2],A=p[3],y=c.getAttribute("data-id"),T=r._find(y);if(T&&T.data[v]){var R=T.data[v];R.data.length&&R.data.forEach(function(t){t.data[I]!=x?(r.set(t,I,x),console.log("Setting to ",x)):r.set(t,I,A),console.log(t)})}}var v=c.getAttribute("data-click-select");if(v){var D,y=c.getAttribute("data-id");if(y){var D=r._find(y);s||(s={}),s[v]||(s[v]=[]);var E,F=s[v];if(D.__p){var S=r._find(D.__p);S&&(S.__selected||(S.__selected={}),S.__selected[v]||(S.__selected[v]=[]),E=S.__selected[v])}var P,L,k,N=c.getAttribute("data-sel-class");if(N){var p=N.split(":");L=p[0],L==v&&(P=p[1])}if((k=F.indexOf(y))>=0){if(P&&$(c).removeClass(P),F.splice(k,1),E){var V;(V=E.indexOf(y))>0&&E.splice(V,1)}}else if(P&&$(c).addClass(P),F.push(y),E){var V;(V=E.indexOf(y))>0||E.push(y)}u=!0}}var M=c.getAttribute("data-click-ctrl");if(M){var U=M.split("/");if(M=U[0],U.shift(),a&&a[M]){var D,y=c.getAttribute("data-id");if(y){var D=r._find(y);u=!0}a[M](D,c,U)}}var W=c.getAttribute("data-click-post-url");if(W){var D,y=c.getAttribute("data-id");if(y){u=!0;var D=r._find(y);c.getAttribute("data-post-only-id")&&(D=r.isArray(D.data)?{__id:D.__id,data:[]}:{__id:D.__id,data:{}}),$.ajax({type:"POST",url:W,data:JSON.stringify(D),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){console.log(t),t.__sCmds&&r.execCommand(t.__sCmds,!0),t.__uiCmds&&t.__uiCmds.forEach(function(t){var e=d[t.cmd];e&&e.apply(r,t.data)})},failure:function(){}})}}var q=c.getAttribute("data-click-create");if(q){var b="{"+q+"}",H=JSON.parse(b);console.log(b),console.log("To create ",JSON.stringify(H));for(var J in H){var y=c.getAttribute("data-id");if(y){u=!0;var D=r._find(y);r.push(D.data[J],H[J])}}}var q=c.getAttribute("data-click-copy");if(q){var y=c.getAttribute("data-id");if(y){var D=r._find(y),S=r._find(D.__p),G=r.duplicate(D);r.push(S,G),u=!0}}var q=c.getAttribute("data-click-to-clipboard");if(q){var y=c.getAttribute("data-id");if(y){var D=r._find(y),S=r._find(D.__p),G=r.toPlainData(D);f=G,u=!0}}var q=c.getAttribute("data-click-from-clipboard");if(q){var y=c.getAttribute("data-id");if(y){var B=r._find(y);if(B&&B.data){var D=B.data[q];D&&f&&D.data&&r.isArray(D.data)&&(r.push(D,f),u=!0)}}}var Q=c.getAttribute("data-click-remove");if(Q){var y=c.getAttribute("data-id");y&&(u=!0,confirm("Remove item?")&&r.removeItem(y))}var z=c.getAttribute("data-click-moveup");if(z){var y=c.getAttribute("data-id");y&&(u=!0,r.moveItemUp(y))}var z=c.getAttribute("data-click-movedown");if(z){var y=c.getAttribute("data-id");y&&(u=!0,r.moveItemDown(y))}var X=c.getAttribute("data-click-view");if(X){var Y=X.split(",");Y.forEach(function(t){var e,i=t.split("/");if(i.length>1){var a=i[1];t=i[0]}var s,f=t.charAt(0);if("."==f){e=t.substring(1);for(var _=c.parentNode;_;)if(_.getAttribute){if(console.log("Looking for ",e),_.getAttribute("data-viewclass")==e){s=_;break}var l;if((l=_.getAttribute("class"))&&l.match(e)){s=_;break}_=_.parentNode}else _=_.parentNode}if("#"==f){e=t.substring(1);var s=document.getElementById(e)}if(s||console.log("Did not find ",t),s){u=!0;var d=c.getAttribute("data-id");if(console.log("data-id ",d),d){var h=r._find(d),v=!1,p=s.getAttribute("data-e-view");if(p&&n&&n[p]){var m=n[p](h);r.pushView(e,m._dom,{sourceElem:c}),v=!0}if(!v){var g;if(g=a?a:s.getAttribute("data-use-view"),console.log("looking view ",g),g){var y=r.findNamedView(g);if(console.log("found view ",y,"composing with",h),y){var w=o.composeTemplate(h,y);r.pushView(s,w,{sourceElem:c,animMs:400,animFn:function(t){$(t).addClass("bounceOut")},animEnd:function(t){$(t).removeClass("bounceOut")}})}}}}}})}return u}}},t._createUploadFrame=function(t){var e=_e(),i=e.form("",{action:t.target,enctype:"multipart/form-data",method:"POST",name:e.guid()}),n=t.maxCnt||20,a=function(e){t.onComplete&&t.onComplete(e)},r="complete"+(new Date).getTime();if(window[r]=a,i.input("",{type:"hidden",value:r,name:"onComplete"}),i.label("control-label").text(t.title||"Valitse tiedostot"),t.vars)for(var o in t.vars)t.vars.hasOwnProperty(o)&&i.input("",{type:"hidden",value:t.vars[o],name:o});var s=i.div("form-group"),c=t.maxFileCnt||5,f=0,_=function(){if(!(f>=c)){var i=s.input("",{type:"file",name:"file_"+f});i.on("value",function(){t.autoUpload?e.uploadFiles():n>f&&_()}),f++}};_();var l=_e("iframe"),d=e.guid();return l.q.attr("id",d),l.q.attr("name",d),l.absolute().x(-4e3).y(-4e3),e.add(l),e.uploadFiles=function(e){if(e)for(var n in e)e.hasOwnProperty(n)&&i.input("",{type:"hidden",value:e[n],name:n});var a=t.tElem.getAttribute("data-upload-to");a&&i.attr({action:a}),i._dom.target=d,i._dom.submit(),s.clear(),f=0,_()},t.getUploader&&t.getUploader(e.uploadFiles),e},t._initUiCommands=function(){var t=this;e||(e=templateCompiler());var i=e;d.openView=function(e,a){var r=!1;if(e){var o=e.split(",");return o.forEach(function(e){var o,s=e.split("/");if(s.length>1){var c=s[1];e=s[0]}var f,_=e.charAt(0);if("#"==_){o=e.substring(1);var f=document.getElementById(o)}if(f&&f&&(r=!0,a)){var l=t._find(a),d=!1,u=f.getAttribute("data-e-view");if(u&&n&&n[u]){var h=n[u](l);t.pushView(o,h._dom,{sourceElem:elem}),d=!0}if(!d){var v;if(v=c?c:f.getAttribute("data-use-view")){var p=t.findNamedView(v);if(p){var m=i.composeTemplate(l,p);t.pushView(f,m,{})}}}}}),r}}},t._mouseDownHandler=function(){_.items=[],_.itemsHash={}},t._mouseMoveHandler=function(t){var e=t.target;if(e&&e.getAttribute){var i=e.getAttribute("data-id");i&&(_.itemsHash[i]||(_.itemsHash[i]=i,_.items.push(i)))}},t._mouseUpHandler=function(){console.log("Drag results"),console.log(_)},t._valueResponder=function(t,e,i,n){var a=t.data[e];if(t.data[e]=i,console.log("_valueResponder with ",e,i),u()._emitEvent(t.__id,"change",[4,e,i,a,t.__id]),n.getAttribute){var r;if(r=n.getAttribute("data-value-filter")){var o,s=r.split("=>"),c=this,f=$.trim(s[1]),_=$.trim(s[2]),l=_.split("/"),d=l[0],h=l[1],v=l[2],p=50;(o=n.getAttribute("data-filter-maxcnt"))&&(p=o),this.query($.trim(s[0]),function(t){t&&t.data&&t.data.forEach&&t.data.forEach(function(t){return 0>p?void c.set(t,d,v):void(t.data[f]&&t.data[f].toLowerCase().match(i.toLowerCase())?(c.set(t,d,h),p--):c.set(t,d,v))})})}}},t.bindBaseEvents=function(t){e||(e=templateCompiler()),_||(_={}),_.touchEnabled=!1;var i=this,n={};if(!t.addEventListener){var a={activeInput:null};return t.attachEvent("onkeyup",function(){if(a.activeInput&&a.routeId){var t=a.routeId,e=a.activeInput,n=t.split("::"),r=n[0],o=u()._find(r),s=n[1];if(!o)return;var c=e.value,f=o.data[s];c!=f&&i._valueResponder(o,s,c,e)}a.activeInput=window.event.srcElement}),t.attachEvent("onfocusin",function(t){var t=t||window.event,e=t.srcElement;a.activeInput=e,a.routeId=e.getAttribute("data-value-id"),a.routeId}),t.attachEvent("onfocusout",function(t){var t=t||window.event,e=t.srcElement,i=e.getAttribute("data-value-id");a.activeInput&&a.routeId==i&&(a.activeInput=null,a.routeId=0)}),void t.attachEvent("onclick",function(t){t=window.event;var e=(new Date).getTime();n.clickFired&&e-n.clickFired<600||(i._clickResponder(t)&&(n.clickFired=e),n.clickFired=e)})}t.addEventListener("mousedown",function(t){i._mouseDownHandler(t)}),t.addEventListener("mousemove",function(t){i._mouseMoveHandler(t)}),t.addEventListener("mouseup",function(t){i._mouseUpHandler(t)}),t.addEventListener("click",function(t){if(!_.touchEnabled){var e=(new Date).getTime();if(!(n.clickFired&&e-n.clickFired<200)){return void(i._clickResponder(t)&&(n.clickFired=e))}}}),window.addEventListener("hashchange",function(){if(r.hashSet)return void console.log("In the middle of the hash setting");var t=document.location.hash;if(console.log("We have a new hash "+t),console.log("No react is ",r.noReactOn),r.noReactOn&&"#"+r.noReactOn==t)return void console.log("Should not react on ",t);var e=l.length;if(e>0){var n=l[e-1];i.popView(n.pushId)}}),t.addEventListener("input",function(t){var e=t.target;if(e){var n=e.getAttribute("data-value-id");if(n){var a=n.split("::"),r=a[0],o=u()._find(r),s=a[1];if(!o)return;var c=e.value,f=o.data[s];c!=f&&i._valueResponder(o,s,c,e)}}},!0),t.addEventListener("change",function(t){console.log("**** GOT CHANGE EVENT ****");var e=t.target;if(e){var n=e.getAttribute("data-value-id");if(console.log("**** TARGET FOR CHANGE EVENT ****"),console.log(t.target),console.log(t.target.value),console.log(n),n){var a=n.split("::"),r=a[0],o=u()._find(r),s=a[1];if(!o)return void console.log("Could not find object with id ",r);console.log("==> value responder");var c=e.value,f=o.data[s];c!=f&&i._valueResponder(o,s,c,e)}}},!1);var o=function(t){_.touchEnabled=!0,n._touchItems=[];var e=t.touches;t.targetTouches&&(e=t.targetTouches),n._touchCount=e.length;for(var i=0;i<e.length;i++){var a={};a.startX=e[0].pageX,a.startY=e[0].pageY,n._touchItems[i]=a}n.touchStartMs=(new Date).getTime(),n.bTouchOn=!0,n.didMove=!1},s=function(t){var e=t.touches;t.targetTouches&&(e=t.targetTouches),n._touchCount=e.length;for(var i=0;i<e.length;i++){var a=n._touchItems[i];a.dx=t.touches[i].pageX-a.startX,a.dy=t.touches[i].pageY-a.startY}n.didMove=!0},c=function(t){n.bTouchOn=!1;var e=(new Date).getTime(),a=e-n.touchStartMs,r=e-(n.clickFired||0),o=0;if(n.didMove){var s=n._touchItems[0].dx,c=n._touchItems[0].dy;o=Math.sqrt(s*s+c*c)}500>a&&r>100&&20>o&&(n.clickFired=e,i._clickResponder(t)&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1,n.clickFired=e))};t.addEventListener("touchstart",o,!1),t.addEventListener("touchmove",s,!1),t.addEventListener("touchend",c,!1)},t.createController=function(t,e){a||(a={}),a[t]=e},t.createView=function(t,e){n||(n={}),n[t]=e},t.findPushId=function(t){if(t){if(t.getAttribute){var e=t.getAttribute("data-pushid");if(e&&c){var i=c[e];if(i)return e}}if(t.parentNode)return this.findPushId(t.parentNode)}},t.findSelection=function(t){return s&&s[t]?s[t]:[]},t.findViewElement=function(t){if(t){var e=t.getAttribute("id");if(e){var n=i[e];if(n)return e}if(t.parentNode)return this.findViewElement(t.parentNode)}},t.findViewIdFromElem=function(t){if(t){if(t.getAttribute){var e=t.getAttribute("id");if(e&&i){var n=i[e];if(n)return e}}if(t.parentNode)return this.findViewIdFromElem(t.parentNode)}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){r||(r={bTransform:!1,hashSet:!1},l=[],_={itemsHash:{},items:[]},d={},this._initUiCommands(),e=templateCompiler()),o||(o=later())}),t.popView=function(t){if(!r.on){if(this.isObject(t)){t=this.findPushId(t)}if(c&&c[t]){l.pop();var e=c[t].pop();if(e){for(var i=e.parentDOM;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(e.viewFrag),console.log(e),this.scrollTo(e.sourceElem?e.sourceElem:i),r.hashSet=!0,r.noReactOn=(new Date).getTime(),document.location.hash=r.noReactOn,later().add(function(){r.hashSet=!1})}}}},t.pushView=function(t,e,n){console.log("pushView called ",t);var a,o,s=this;if(this.isObject(t)){if(o=t,t=o.getAttribute("data-viewid"),console.log("pushView with ",o,t),!t)return}else a=t,o=document.getElementById(t);if(!r.on&&o){n||(n={}),l||(l=[]),r.hashSet=!0,r.noReactOn=(new Date).getTime(),document.location.hash=r.noReactOn,later().add(function(){r.hashSet=!1}),i||(i={}),i[t]||(i[t]=[]);var f=this.guid();c||(c={}),c[f]||(c[f]=[]),e.setAttribute("data-pushid",f);for(var _=document.createDocumentFragment();o.firstChild;){var d=o.firstChild;o.removeChild(d),_.appendChild(d)}var u={viewFrag:_,parentDOM:o,sourceElem:n.sourceElem||null,pushId:f};return l.push(u),i[t].push(u),c[f].push(u),s.scrollTo(e),o.appendChild(e),this}},t.scrollTo=function(t){if(window){var e={left:0,top:0,width:800,height:800};try{"undefined"!=typeof t.getBoundingClientRect&&(e=t.getBoundingClientRect())}catch(i){e={left:0,top:0,width:800,height:800}}var n=window.pageXOffset,a=e.top;if(a<window.innerHeight/2)return;e.top<window.innerHeight?a/=2:a-=.2*window.innerHeight,window.scrollTo(n||0,parseInt(a))}},t.touchEvents=function(){var t=this._dom;if(t.addEventListener){var e=this;this._touchItems=[];var i=function(t){e._touchItems=[];var i=t.touches;t.targetTouches&&(i=t.targetTouches),e._touchCount=i.length;for(var n=0;n<i.length;n++){var a={};a.startX=i[0].pageX,a.startY=i[0].pageY,e._touchItems[n]=a}e.trigger("touchstart"),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1},n=function(t){var i=t.touches;
t.targetTouches&&(i=t.targetTouches),e._touchCount=i.length;for(var n=0;n<i.length;n++){var a=e._touchItems[n];a.dx=t.touches[n].pageX-a.startX,a.dy=t.touches[n].pageY-a.startY}e.trigger("touchmove"),t.preventDefault&&t.preventDefault()},a=function(t){e.trigger("touchend"),t.preventDefault&&t.preventDefault(),t.returnValue=!1};t.addEventListener("touchstart",i,!1),t.addEventListener("touchmove",n,!1),t.addEventListener("touchend",a,!1)}}}(this),function(t){var e;t.getDataAccessMethods=function(t){for(;t&&t.length&&" "==t.charAt(0);)t=t.substring(1);var e,i,n=t.split("://"),a={bRemote:!1};if(n.length>1){var r=n.shift(),i=n.shift(),o=i.split(" ");o.length>0&&(i=o.shift(),e=o.join(" "),a.dataQuery=e,a.queryInfo=this.getQueryInfo(e)),a.remoteUrl=r+"://"+i,a.protocol=r,a.bRemote=!0;var s=i.split("/"),c=s.shift(),f=c.split(":"),_=f[0],l=f[1];a.port=l,a.ip=_;var d=s.shift(),u=s.pop(),h=s.join("/");a.remoteSandbox=d,a.removeFileName=u,a.remotePath=h}else a.bCurrentData=!0,a.dataQuery=n[0],a.queryInfo=this.getQueryInfo(a.dataQuery);return a},t.getQueryInfo=function(t){for(var e={};t&&t.length&&" "==t.charAt(0);)t=t.substring(1);var i=function(t){for(var e=t.length,i=!1,n=e-1;n>=0;)t[n]&&0!=t[n].length?(" "==t[n]?i?t.splice(n,1):i=!0:i=!1,n--):(t.splice(n,1),n--);return t};if(t){var n=t,a=t.split(" ");if(a=i(a),"#"==n.charAt(0)){var r=a.shift();e.bNamedView=!0,e.viewName=r.substring(1),n=a.join(" ")}if("@"==n.charAt(0)){var r=a.shift();e.bMetaData=!0,e.metaName=r.substring(1),n=a.join(" ")}a[0]&&("select"==a[0].toLowerCase()?(e.selectCmd=a.shift(),e.pathQuery=a.shift()):e.pathQuery=a.shift(),a[0]&&"as"==a[0].toLowerCase()&&(e.asCmd=a.shift(),e.asName=a.shift()))}if(e.pathQuery){var o=e.pathQuery.split(":");o.length>1&&(e.pathQuery=o[0],e.customType=o[1])}return e},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(e={})}),t.query=function(t,e,i){var n=this.getDataAccessMethods(t),a=this;if(n.bRemote){var r=u(n.remoteUrl);r.then(function(){var t=r.fetch(n.queryInfo.pathQuery);n.queryInfo.asName&&a.setNamedModel(n.queryInfo.asName,t),e(t)})}else{if(n.queryInfo.bNamedView&&(i=a.getNamedModel(n.queryInfo.viewName),!i))return void e(null,null);if(i||(i=a.getData()),n.queryInfo.bMetaData&&i&&(i=a.getMeta(i,n.queryInfo.metaName),!i))return void e(null,null);n.queryInfo.pathQuery||(n.queryInfo.pathQuery="/");var o=a.fetch(n.queryInfo.pathQuery,i);if(n.queryInfo.asName&&a.setNamedModel(n.queryInfo.asName,o),n.queryInfo.customType){var s=templateCompiler().createViewType(n.queryInfo.customType,o,{});s&&(o=s.textContent||s.innerText||"")}e(o,{obj:a._lastQueryObj,name:a._lastQueryVar})}}}(this),function(t){var i,n,a;t._disableChannel=function(t){var e=this._getChannelPoints(t);e.disabled||(e.disableIndex=e.i),e.disabled=!0},t._enableChannel=function(t){var e=this._getChannelPoints(t);e.disabled=!1},t._getChannelPoints=function(t){return n[t]||(n[t]={i:0,o:0,currentPointer:0,currentPromise:null,currentMainPromise:null,waitingList:[]}),n[t]},t._getCommandCnt=function(t){if(!i)return 0;if(!i[t])return 0;var e=this._getChannelPoints(t),n=e.i,a=i[t];return a.length-n},t._getCommandHistory=function(t){return i&&i[t]?i[t]:[]},t._getCommandPointer=function(){return n.i},t._hasNewCommands=function(t){if(i&&i[t]){var e=this._getChannelPoints(t),n=e.i,a=i[t],r=a[n];return r?!0:!1}},t._isAtEndNoWaiting=function(t){var e=this._getChannelPoints(t);return 0!=this._getCommandCnt(t)||0!=e.waitingList.length||e.currentMainPromise?!1:!0},t._isChannelDisabled=function(t){var e=this._getChannelPoints(t);return e.disabled},t._popChannelCommand=function(t){if(i&&i[t]){var e=this._getChannelPoints(t),n=e.i,a=i[t],r=a[n];if(r)return e.i++,r}},t._pushChannelCommand=function(t,e,n,a,r){if(i[t]||(i[t]=[]),e=e.slice(),e[5]=i[t].length,this._isChannelDisabled(t))return void i[t].push({cmd:e,ctx:n,r:a,radio:r});if(a&&this._isAtEndNoWaiting(t)&&4==e[0]){this._realExecCmd(e,!0),i[t].push({cmd:e,ctx:n,r:a,radio:r,done:!0});var o=this._getChannelPoints(t);o.i++}else e[6]=(new Date).getTime(),i[t].push({cmd:e,ctx:n,r:a,radio:r})},t._startChannelLoop=function(t){if(!a[t]){a[t]=!0;var e=this;later().every(1/30,function(){e._isChannelDisabled(t)||e._hasNewCommands(t)&&e._stepCommandList(t)})}},t._stepCommandList=function(t){var i=this._getChannelPoints(t),n=!1;i.currentMainPromise&&(n=!0);for(var a,r,o=f(),s=(o.namespace(t),e()),c=e(),_=this,l=function(t,n){return t.then(function(){var t=!1;n.ctx&&(_.isObject(n.ctx)?_._setCtx(n.ctx):_._enterCtx(n.ctx));var a;return(a=n.r?_._realExecCmd(n.cmd,n.r,t):e())?(n.cmd=_._transformCmdFromNs(n.cmd),i.currentPromise=a,i.currentPromiseMs=(new Date).getTime(),a.then(function(){n.ctx&&(_.isObject(n.ctx)?_._resetCtx():_._leaveCtx(n.ctx))}).fail(function(){console.error("FAILED command ",n),n.ctx&&(_.isObject(n.ctx)?_._resetCtx():_._leaveCtx(n.ctx))}),a):(a=e(),a.resolve(!0),a)})},d=s,u=0,h=[];a=this._popChannelCommand(t);)a.done||(!a.r&&a.radio?(r=a.radio,h.push(this._wrapRemoteCmd(a))):(d=l(d,a),u++));return h.length&&r.send(t,h),d.then(function(){c.resolve(!0)}).fail(function(t){console.error("*** _stepCommandList failed "+t)}),c.then(function(){if(i.currentMainPromise=null,i.currentPromise=null,i.waitingList.length){var t=i.waitingList.shift();t.resolve(!0)}}),n?(i.waitingList.push(s),s.then(function(){i.currentMainPromise=c})):(i.currentMainPromise=c,s.resolve(!0)),c},t._wrapRemoteCmd=function(t){var e;return t.ctx&&(e=this.isObject(t.ctx)?t.ctx:this._createContextVar(t.ctx)),t.cmd=this._transformCmdFromNs(t.cmd.slice()),{ctx:e,cmd:t.cmd}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(i={},n={},a={})})}(this),function(t){t.createForkedObject=function(t,e){if(!this.isObject(t)&&!this.isArray(t))return t;var i;i=this.isArray(t.data)?[]:{};var n={data:i,__id:this.guid(),__fork:t.__id};if(e?n.__p=e.__id:t.__radioURL&&(n.__forkURL=t.__radioURL),this.isArray(t.data))for(var a=t.data.length,r=0;a>r;r++)i[r]=this.createForkedObject(t.data[r],n);else for(var o in t.data)t.data.hasOwnProperty(o)&&(i[o]=this.createForkedObject(t.data[o],n));return n},t.fork=function(){}}(this),function(t){var i,n,a,r,o,s,c,_,l,d;t._addModelView=function(t,e){r||(r={}),r[t]||(r[t]=[]),r[t].push(e)},t._addToCache=function(t){t&&t.__id&&(i[t.__id]=t)},t._atPath=function(t,e){if(t){var i=t.split("/");if(e||(e=this._data),"/"==t.charAt(0))for(i.unshift();e.__p;)e=this._find(e.__p);for(var n=e,a={obj:null,name:"",type:""};i.length>0;){var r=i.shift();if(0==r.length)break;if(e.data){if(".."==r){var o=this._find(e.__p);if(o){e=o,n=e;continue}return null==a.obj,a}var s=e.data[r];if("undefined"==typeof s)return null==a.obj,a;this.isObject(s)?(a.obj=s,a.type="obj",a.name=null,e=s,this.isArray&&(a.type="array")):(a.obj=e,a.name=r)}}return a}},t._changeToRemote=function(t,i,n){if(t){console.log("change to remote called "+i);var a=e(),r=u()._find(n),o=this;if(r){var s=o._createReflection(r,i,t);return s.then(function(e){console.log("reflection done"),t.data=e.data,e.__vpid&&(t.__vpid=e.__vpid),e.__vcid&&(t.__vcid=e.__vcid),a.resolve(r)}),a}var c=u(i,{});return console.log("starting loader "),c.then(function(){console.log("finished loader ");var e=c._find(n);if(e){console.log("Remote data "),console.log(JSON.parse(JSON.stringify(e))),console.log("creating reflection ");var r=o._createReflection(e,i,t);r.then(function(i){console.log("reflection done"),t.data=i.data,i.__vpid&&(t.__vpid=i.__vpid),i.__vcid&&(t.__vcid=i.__vcid),a.resolve(e)})}else console.error(" did not find "+i+"/"+n),a.fail(" did not find "+i+"/"+n)}),a}},t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t){if(!this.isObject(t)&&t){var e;if(e=this._myClassCache(t))return e;this._myClassCache(t,this)}}),t._clearWorkers=function(t){var e=this;t.workers.forEach(function(t){e._removeWorker(t)}),t.childViews.forEach(function(t){e._clearWorkers(t)})},t._cmd=function(t,e,i){var n=t[4],r=a;if(e||(e=this._find(n)),r&&e){var o;if(o=r[n]){if(4==t[0]||13==t[0]){var s;if(s=o[t[1]]){s=s.slice();for(var c=s.length,f=0;c>f;f++){var _=s[f][0],l=s[f][1],d=s[f][2];_.run(t,e,l,d)}}if(s=o["*"]){s=s.slice();for(var c=s.length,f=0;c>f;f++){var _=s[f][0],l=s[f][1],d=s[f][2];_.run(t,e,l,d)}}}if(12==t[0]||7==t[0]||8==t[0]){var s;if(s=o["*"]){s=s.slice();for(var c=s.length,f=0;c>f;f++){var _=s[f][0],l=s[f][1],d=s[f][2];_.run(t,i,l,e,d)}}}}}},t._createModelCommands=function(t,e,i){i||(i=[]);var n;if(n=t.data&&t.__id?t.data:t,this.isObject(n)||this.isArray(n)){var a;if(a=t.__id?t:{data:n,__id:this.guid()},this.isArray(n))var r=[2,a.__id,[],null,a.__id];else var r=[1,a.__id,{},null,a.__id];e&&(a.__p=e.__id),i.push(r);for(var o in n)if(n.hasOwnProperty(o)){var s=n[o];if(this.isObject(s)||this.isArray(s)){var c=this._createModelCommands(s,a,i),r=[5,o,c.__id,null,a.__id];i.push(r)}else{var r=[4,o,s,null,a.__id];i.push(r)}}return a}},t._createNewModel=function(t,e){if(this.isObject(t)||this.isArray(t)){var n={data:t,__id:this.guid()};if(i[n.__id]=n,this.isArray(t))var a=[2,n.__id,[],null,n.__id];else var a=[1,n.__id,{},null,n.__id];e&&(n.__p=e.__id),this.writeCommand(a,n);for(var r in t)if(t.hasOwnProperty(r)){var o=t[r];if(this.isObject(o)||this.isArray(o)){var s=this._createNewModel(o,n);n.data[r]=s;var a=[5,r,s.__id,null,n.__id];this.writeCommand(a,n),this._moveCmdListToParent(s)}else{var a=[4,r,o,null,n.__id];this.writeCommand(a,n)}}return n}},t._createReflection=function(t,n,a){var r,o=e(),s=this,c=[];if(!n&&t.__radioURL&&t.__rid){var f=s._find(t.__rid);if(!f){var _=u(t.__radioURL);return _.then(function(){var e=s._createReflection(t,n,a);e.then(function(t){o.resolve(t)})}),o}}if(a?(r=a,r.__rid=t.__rid?t.__rid:t.__id,a.__vpid?(r.__vpid=a.__vpid,r.__vcid=a.__vcid):(r.__vpid=a.__p,r.__vcid=a.__id)):(r={__id:this.guid(),__rid:t.__id,__radioURL:n},t.__rid&&(r.__rid=t.__rid)),t.__vpid&&(r.__vpid=t.__vpid,r.__vcid=t.__vcid),t.__rid?this._addReflection(r.__rid,r.__id):this._addReflection(r.__rid,r.__id),r.__vcid&&this._addReflection(r.__vcid,r.__id),i[r.__id]=r,n&&(r.__radioURL=n),t.__radioURL&&(r.__radioURL=t.__radioURL),this.isArray(t.data)){r.data=[];for(var l=t.data.length,d=0;l>d;d++){var h=t.data[d];if(this.isObject(h)){var v=this._createReflection(h);c.push(v),function(t){v.then(function(e){r.data[t]=e,r.data[t].__p=r.__id})}(d)}else r.data[d]=h}}else{r.data={};for(var p in t.data)if(t.data.hasOwnProperty(p)){var h=t.data[p];if(this.isObject(h)){var v=this._createReflection(h);c.push(v),function(t){v.then(function(e){r.data[t]=e,r.data[t].__p=r.__id})}(p)}else r.data[p]=h}}if(c.length){var m=e();m.all(c).then(function(){o.resolve(r)}),m.resolve(!0)}else o.resolve(r);return o},t._createWorker=function(t,e,i,n,r){var o=a[t];o||(o=a[t]={});var s=o[e];s||(s=a[t][e]=[]);var c=[i,n,r];return s.push(c),[s,c]},t._emitEvent=function(t,e,a){var r=i[t];if(r){var o;n&&(o=n[t])&&o[e]&&o[e].forEach(function(t){t(a)}),r.__p?this._emitEvent(r.__p,e,a):(console.log("did not find the parent object..."),"change"!=e||n[t]||(console.log("Might trigger the change for this object"),r.__rid&&(console.log("it was also reflected object"),console.log(r),console.log(a),this.execCommand(a))))}},t._find=function(t){return i[t]},t._findObjects=function(t,n){var a=e();if(!this.isObject(t))return a.resolve(t),a;t=this._wrapData(t),t.__id&&(i[t.__id]=t);var r=this;if(t.__rid&&t.__radioURL){var o=u(t.__radioURL,{}),r=this;return o.then(function(){var e=o._find(t.__rid);if(e){var s=r._createReflection(e,t.__radioURL,t);s.then(function(){t.__p=n,i[t.__id]=t,a.resolve(t)})}else a.resolve(t)}),a}n&&(t.__p=n);var s=[];if(t.data){var c=t.data;for(var f in c)if(c.hasOwnProperty(f)){var _=c[f];if(this.isObject(_)){var l=this._findObjects(_,t.__id);s.push(l),function(e,i){l.then(function(n){n!==i&&(t.data[e]=n)})}(f,_)}}}if(s.length){var d=e();d.all(s).then(function(){a.resolve(t)}),d.resolve(!0)}else a.resolve(t);return a},t._findObjects2=function(){if(!this.isObject(data))return whenReady&&whenReady.resolve(data),data;data=this._wrapData(data),data.__id&&(i[data.__id]=data);var t=this;if(data.__rid&&data.__radioURL){console.log("_findObjects with ",data);var e=u(data.__radioURL,{}),t=this;return t._waitingPromises||(t._waitingPromises=[]),t._waitingPromises.push(e),e.then(function(){console.log("Finding ",data.__rid);var n=e._find(data.__rid);if(n){console.log("Creating reflection ",n,data.__radioURL,data);var a=t._createReflection(n,data.__radioURL,data);console.log(a),data.__p=parentId,i[data.__id]=data;var r=t._unresolved.indexOf(e);t._unresolved.splice(r,1),0==t._unresolved.length&&0==t._waitingPromises.length&&(console.log("**** unresolved == 0 ****, resolving this "),t.resolve(t._data))}}),data}if(data.__virtual){var e=u(data.__radioURL,{}),t=this;return t._unresolved.push(e),e.then(function(){console.log("Got remote data"),console.log(e),data.data=e._data.data,data.__radio=e._data.__radio,data.__id=e._data.__id,i[data.__id]=data;var n=t._unresolved.indexOf(e);t._unresolved.splice(n,1),0==t._unresolved.length&&t.resolve(t._data)}),data}if(parentId&&(data.__p=parentId),data.data){var n=data.data;for(var a in n)if(n.hasOwnProperty(a)){var r=n[a];if(this.isObject(r)){var o=this._findObjects(r,data.__id);o!==r&&(data.data[a]=o)}}}return data},t._findRadioURL=function(t){return t||(t=this._data),t&&t.__radioURL?t.__radioURL:void 0},t._getAllWorkers=function(){return a},t._getChannelCommands=function(t){return d?d[t]:void 0},t._getCommandsFor=function(){},t._getModelViews=function(t){return r[t]},t._getObjectHash=function(){return i},t._getObjectInPath=function(t,e){if(t){var i=t.split("/");e||(e=this._data);var n=e,a=t;for(this._lastQueryObj=n,this._lastQueryVar=a;i.length>0;){var r=i.shift();if(0==r.length)break;if(e.data){if(".."==r){var o=this._find(e.__p);if(o){e=o,n=e;continue}return}var s=e.data[r];if(this.isObject(s)&&(n=s),s){a=r,e=s;continue}return}}return this._lastQueryObj=n,this._lastQueryVar=a,this.isObject(e)?e:e}},t._iterate=function(){},t._myClassCache=function(t,e){return l||(l={}),"undefined"==typeof e?l[t]:void(l[t]=e)},t._onValue=function(t,e,i){var a;n||(n={}),n[t]||(n[t]={}),n[t][e]||(n[t][e]=[]),a=n[t][e],a.indexOf(i)<0&&a.push(i)},t._prepareData=function(t){var e=this._wrapData(t);return i[e.__id]||(e=this._findObjects(e)),e},t._removeView=function(t){var e=t.dom;console.log("_removeView called "),e.parentNode&&e.parentNode.removeChild(e);var i;if(i=t.parentView){var n=i.childViews.indexOf(t);i.childViews.splice(n,1)}console.log("calling _clearWorkers "),this._clearWorkers(t)},t._removeWorker=function(t){if(t){var e=t[0],i=t[1];if(e&&i){var n=e.indexOf(i);n>=0&&e.splice(n,1)}}},t._triggerEvent=function(){i[objid]},t._wrapData=function(t){if(t&&t._wrapData)return t._data;if(t.__id&&t.data)return t;var e=this._createNewModel(t);return e},t.duplicate=function(t){var e=this.toPlainData(t),i=u(e);return i.getData()},t.fetch=function(t,e){var i=this._getObjectInPath(t,e);return i?i:void 0},t.findNamedView=function(t){return s||(s=templateCompiler()),s._getNamedView(t)},t.forTree=function(t,e){if(this.isFunction(t))e=t,t=this._data;else if(!this.isObject(t)||!this.isFunction(e))return;if(e(t),t.data){var i=t.data;for(var n in i)if(i.hasOwnProperty(n)){var a=i[n];this.isObject(a)&&this.forTree(a,e)}}return this},t.getData=function(){return this._data},t.getMeta=function(t,e){if(this.isObject(t)){if(!t.__meta)return;var i=t.__meta[e];if(i){var n=u(i);return n.getData()}}},t.getNamedModel=function(t){return _?_[t]:void 0},t.getNamedViews=function(){return s?s._getNamedViews():void 0},t.indexOf=function(t){if(t||(t=this._data),this.isObject(t)||(t=this._find(t)),t){var e=this._find(t.__p);if(e&&this.isArray(e.data))return e.data.indexOf(t)}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){this._unresolved||(this._unresolved=[]),i||(i={},a={});var n=this;if(t&&!this.isObject(t)&&"http://"==t.substring(0,7)){console.log("##### Fetching data from ",t);var r=t,o={onCommand:function(t,e){t=n._transformCmdToNs(t,n._getNsFromUrl(r)),n._pushChannelCommand(r,t,e,!0)},onFile:function(e,i,a){console.log("---- ON FILE ---- "),e=n._transformObjToNs(e,n._getNsFromUrl(a)),n._data=e;var r=n._findObjects(e);r.then(function(e){if(n._data!=e&&(n._data=e),i&&i.length){i.forEach(function(t){t=n._transformCmdToNs(t,n._getNsFromUrl(a)),n._pushChannelCommand(a,t,{},!0)});var r=n._stepCommandList(a);r&&r.then(function(){n._data.__radioURL=t,n._data.__radio=s,n._startChannelLoop(n._data.__radioURL),n.resolve(n._data)}).fail(function(){})}else n._data.__radioURL=t,n._data.__radio=s,n._data._cmdList&&delete n._data._cmdList,n._data._ctxCmdList&&delete n._data._ctxCmdList,n._startChannelLoop(n._data.__radioURL),n.resolve(n._data)}).fail(function(e){console.error("Failed for "+t),console.error(e)}),c||(c={}),c[n._data.__id]||(c[n._data.__id]=!0,n.onValue(function(t){n.execCommand(t)}))}};e&&this.isObject(e)&&e.createWith&&(o.createWith=e.createWith),e&&this.isObject(e)&&e.dataNS&&(o.dataNS=e.dataNS);var s=f(),n=this;return void s.listen(t,o)}if(t){this._data=t;var _=this._findObjects(t);_.then(function(e){t!=e&&(n._data=e),n._data&&(c||(c={}),c[n._data.__id]||(c[n._data.__id]=!0,n.onValue(function(t){console.log("onValue ",JSON.stringify(t)),n.execCommand(t)}))),n.resolve(n._data)})}}),t.listNamedModels=function(){return _},t.loadRemoteData=function(t){var e=_connectManager().createSocketServer({ip:t.ip,port:t.port}),i=this,n=e.createChannel(t);n.then(function(){n.getFileData(function(t,e){i._data=t;var n=i._findObjects(t);i._data!=n&&(this._data=n),e&&e.length&&e.forEach(function(t){i.execCommand(t,!0)}),i.resolve(i._data)})})},t.loadRemoteUrls=function(){if(o)return o;o=!0;var t=[],e=document.querySelectorAll("[data-src]");console.log("Data src list",e);for(var i=0;i<e.length;i++){var n=e[i],a=function(e){var i=e.getAttribute("data-src"),n=this.parseRemoteUrl(i);t.push(n)};a(n)}return o=t,t},t.moveItemDown=function(t){var e,i=this._find(t);if(i){var n=this._find(i.__p);if(n&&this.isArray(n.data)){e=n.data.indexOf(i);var a=e-1,r=n.data.length;return a>=0&&r>a&&this.execCommand([12,i.__id,a,e,i.__p]),this}}},t.moveItemToPos=function(t,e){var i,n=this._find(t);if(n){var a=this._find(n.__p);if(a&&this.isArray(a.data)){i=a.data.indexOf(n);var r=a.data.length;return e>=0&&r>e&&this.execCommand([12,n.__id,e,i,n.__p]),this}}},t.moveItemUp=function(t){var e,i=this._find(t);if(i){var n=this._find(i.__p);if(n&&this.isArray(n.data)){e=n.data.indexOf(i);var a=e+1,r=n.data.length;return a>=0&&r>a&&(console.log("Got item up into ",a),this.execCommand([12,i.__id,a,e,i.__p])),this}}},t.onValue=function(t,e,i){return this.isFunction(t)?(this._data&&this._onValue(this._data.__id,"change",t),this):this.isFunction(e)?(this._data&&this._onValue(this._data.__id,t,e),this):this._onValue(t,e,i)},t.parseRemoteUrl=function(t){var e=t.split("://"),i=(e.shift(),e.shift()),n=i.split("/"),a=n.shift(),r=a.split(":"),o=r[0],s=r[1],c=n.shift(),f=n.pop(),_=n.join("/"),l={channel:{ip:o,port:s,sandbox:c,path:_,file:f,auth:{u:"abba",p:"nowp"}}};return l},t.push=function(t,i,n){var a=this,r=e();if(this.isObject(t)&&this.isObject(t.data)&&!this.isArray(t.data)){var o=t,s=u(i);return s.then(function(){var t=s._data;a.execCommand([5,n,t.__id,null,o.__id]).then(function(){r.resolve(!0)}),s._moveCmdListToParent(t)}),r}if(this.isObject(t)&&this.isArray(t.data)){var o=t,s=u(i);return s.then(function(){var t=s._data;a.execCommand([7,o.data.length,t.__id,null,o.__id]).then(function(){r.resolve(!0)}),s._moveCmdListToParent(t)}),r}var o=this._getObjectInPath(t);if(o&&this.isArray(o.data)){var s=u(i);s.then(function(){var t=s._data;a.execCommand([7,o.data.length,t.__id,null,o.__id]).then(function(){r.resolve(!0)}),s._moveCmdListToParent(t)})}return r},t.removeItem=function(t){var e=this._find(t);if(console.log("removeItem",e),e&&e.__id){var i=this._find(e.__p);this.isObject(i)&&this.isArray(i.data)&&this.execCommand([8,0,e.__id,null,i.__id])}},t.render=function(t){s||(s=templateCompiler());var e,i=s,n=this;e=this.isObject(t)?t:i.compile(t);var a=i.composeTemplate(n._data,e);return c||(c={}),c[n._data.__id]||(c[n._data.__id]=!0,n.onValue(function(t){n.execCommand(t)})),a},t.renderFrom=function(t,e,i,n){{var a=u(t),r=this;new Date}a.then(function(){console.log("Got the DOC!"),console.log(a);var t="";t=r.isFunction(e)?e():e;var o,s=a.fetch(t),c=!1;s.data.compiledTemplate?(o=JSON.parse(s.data.compiledTemplate),c=!0):o=s.data[i];var f=(new Date,r.render(o));n&&n.appendChild(f),r.isFunction(e)&&e(function(){var t=e(),n=a.fetch(t),o=n.data[i],s=templateCompiler();s.clearTheView(f.getAttribute("data-viewid"));var c=r.render(o);f.parentNode&&(f.parentNode.replaceChild(c,f),f=c)}),c?a.addListener(t+".compiledTemplate",function(t,e){var i=templateCompiler();i.clearTheView(f.getAttribute("data-viewid"));var n=r.render(JSON.parse(e));f.parentNode&&(f.parentNode.replaceChild(n,f),f=n)}):a.addListener(t+"."+i,function(t,e){var i=templateCompiler();i.clearTheView(f.getAttribute("data-viewid"));var n=r.render(e);f.parentNode&&(f.parentNode.replaceChild(n,f),f=n)})})},t.set=function(t,e,i){if(this.isObject(i)){var n=u(i),a=this;n.then(function(){var i=n.getData();console.log("set has now data "),console.log(i),t.data[e]||i.__p||(console.log("going to run the command now"),console.log([5,e,i.__id,null,t.__id]),a.execCommand([5,e,i.__id,null,t.__id]))}).fail(function(t){console.log("creating the object failed "),console.log(t)})}else if(t&&t.data&&t.data[e]!=i){var r=t.data[e];this.execCommand([4,e,i,r,t.__id])}return this},t.setMeta=function(t,e,i){if(this.isObject(t)){t.__meta||(t.__meta={});var n=u(i);t.__meta[e]=n.getData()}},t.setNamedModel=function(t,e){_||(_={}),_[t]=e},t.toPlainData=function(t){if(!this.isObject(t))return t;var e;if(t.getData&&(t=t.getData()),this.isArray(t.data)){e=[];for(var i=t.data.length,n=0;i>n;n++)e[n]=this.toPlainData(t.data[n])}else{e={};for(var a in t.data)t.data.hasOwnProperty(a)&&(e[a]=this.toPlainData(t.data[a]))}return e},t.treeToList=function(t,e){u({list:[]});return this.forTree(function(i){t(i)&&e.data.push(i)}),e},t.unset=function(t,e){return this.isObject(t)||(t=this._find(t)),t&&t.data&&e&&this.execCommand([10,e,null,null,t.__id]),this}}(this)};d.prototype=e.prototype;var u=function(t,e,i,n,a,r,o,s){if(!(this instanceof u))return new u(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=u._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};u._classInfo={name:"_docUp"},u.prototype=new d,"undefined"!=typeof window&&(window._docUp=u),"undefined"!=typeof window&&(window._docUp_prototype=d);var h=function(){var t=function(){var t=function(){!function(t){var e,i,n,a,r;t.add=function(t,e,n){if(e||n){var a;"[object Array]"===Object.prototype.toString.call(n)?a=n:(a=Array.prototype.slice.call(arguments,2),a||(a=[])),i.push([e,t,a])}else i.push(t)},t.after=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),a[i]={step:Math.floor(1e3*t),fn:e,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),a[i]={step:Math.floor(1e3*t),fn:e,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!e){this.polyfill();var t,o;if("undefined"!=typeof window){var t=window.requestAnimationFrame,o=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(e){t||(t=window[e+"RequestAnimationFrame"],o=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),o||(o=function(t){clearTimeout(t)}),i=[],n={},a={},r=[];var s=0,c=function(){for(var e,o=(new Date).getTime();e=i.shift();)"[object Array]"===Object.prototype.toString.call(e)?e[1].apply(e[0],e[2]):e();for(var f=0;f<r.length;f++){var _=r[f];_()}for(var l in n)if(n.hasOwnProperty(l)){var d=n[l];d[0](d[1]),delete n[l]}for(var l in a)if(a.hasOwnProperty(l)){var d=a[l];d.nextTime<o&&(d.remove?d.nextTime>0?(d.fn(),delete a[l]):d.nextTime=o+d.step:(d.fn(),d.nextTime=o+d.step)),d.until&&d.until<o&&delete a[l]}t(c),s=o};c(),e=!0}}),t.once=function(t,e,i){n[t]=[e,i]},t.onFrame=function(t){r.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var e=r.indexOf(t);return e>=0?(t._onRemove&&t._onRemove(),r.splice(e,1),!0):!1}}(this)},i=function(t,e,n,a,r,o,s,c){if(!(this instanceof i))return new i(t,e,n,a,r,o,s,c);var f=[t,e,n,a,r,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=i._classInfo.name)return new _(t,e,n,a,r,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"later"},i.prototype=new t,"undefined"!=typeof window&&(window.later=i),"undefined"!=typeof window&&(window.later_prototype=t),function(t){t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.all=function(t){var i;i=this.isArray(t)?t:Array.prototype.slice.call(arguments,0);var n=i.length,a=0,r=[],o=new Array(n);return this.then(function(){var t=e();return 0==i.length&&t.resolve([]),i.forEach(function(e,i){e.then?(r.push(e),e.then(function(e){o[i]=e,a++,a==n&&t.resolve(o)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.collect=function(t,i,n){var a;a=this.isArray(i)?i:[i];var r=a.length,o=!1,s=!1,c=0,f=[],_=n||{};return this.then(function(){var i=e();return a.forEach(function(e){e.then?(f.push(e),e.then(function(e){c++,o=t(e,_),(o&&!s||0==s&&r==c)&&(i.resolve(_),s=!0)},function(t){i.reject(t)})):i.reject("Not list of promises")}),i})},t.fail=function(t){return this.then(null,t)},t.fulfill=function(t){if(!(this._rejected||this._fulfilled&&t!=this._stateValue)){this._fulfilled=!0,this._stateValue=t;for(var e=this._childPromises.length;e--;){var i=this._childPromises.shift();if(i._onFulfill)try{var n=i._onFulfill(t);"undefined"!=typeof n?i.resolve(n):i.fulfill(t)}catch(a){i.reject(a)}else i.fulfill(t)}this._state=1,this.triggerStateChange()}},t.genPlugin=function(t,i){this.plugin(t,function(){var t=Array.prototype.slice.call(arguments,0);console.log("Plugin args",t);var n=e();return this.then(function(){var e=Array.prototype.slice.call(arguments,0),a=t.concat(e),r=i.apply(this,a);n.resolve(r)},function(t){n.reject(t)}),n})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){if(this._state=0,this._stateValue=null,this._isAPromise=!0,this._childPromises=[],this.isFunction(t)&&(this._onFulfill=t),this.isFunction(e)&&(this._onReject=e),!e&&this.isFunction(t)){var n=this;i().asap(function(){console.log("--- calling the onFulfilled "),t(function(t){n.resolve(t)},function(t){n.resolve(t)})})}}),t.isFulfilled=function(){return 1==this._state},t.isPending=function(){return 0==this._state},t.isRejected=function(){return 2==this._state},t.nodeStyle=function(t,e){this.plugin(t,function(){var t,i,n=Array.prototype.slice.call(arguments,0),a=0;n.length>=0&&(t=n[n.length-1],"[object Function]"==Object.prototype.toString.call(t)&&(i=t,a=n.length-1));var r=wishes().pending();return this.then(function(){var t=wishes().pending(),o=Array.prototype.slice.call(arguments,0);console.log("Orig args",n),console.log("Then args",o);var s;0==n.length&&(s=o),0==o.length&&(s=n),s||(s=o.concat(n)),a=s.length,i&&a--,s[a]=function(e){if(e)return console.log("Got error ",e),t.reject(e),void r.reject(e);if(i){var n=Array.prototype.slice.call(arguments),a=i.apply(this,n);r.resolve(a)}else{var n=Array.prototype.slice.call(arguments,1);r.resolve.apply(r,n)}},t.then(function(t){r.resolve(t)}),console.log("nodeStyle after concat",s);e.apply(this,s);return t},function(t){r.reject(t)}),r})},t.onStateChange=function(t){this._listeners||(this._listeners=[]),this._listeners.push(t)},t.plugin=function(e,i){return t[e]=i,this},t.props=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push({name:i,promise:t[i]});var n=e.length,a=0,r=[],o={};return this.then(function(){var t=wishes().pending();return e.forEach(function(e){var i=e.promise,s=e.name;i.then?(r.push(i),i.then(function(e){o[s]=e,a++,a==n&&t.resolve(o)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.reject=function(t){if(!(this._fulfilled||this._rejected&&t!=this._rejectReason)){this._state=2,this._rejected=!0,this._rejectReason=t;for(var e=this._childPromises.length;e--;){var i=this._childPromises.shift();if(i._onReject)try{i._onReject(t),i.reject(t)}catch(n){i.reject(n)}else i.reject(t)}this.triggerStateChange()}},t.rejectReason=function(t){return t?void(this._rejectReason=t):this._rejectReason},t.resolve=function(t){if(!(this._state>0)){if(t==this)return this._rejectReason="TypeError",void this.reject(this._rejectReason);if(this.isObject(t)&&t._isAPromise){if(this._state=t._state,this._stateValue=t._stateValue,this._rejectReason=t._rejectReason,0===this._state){var e=this;t.onStateChange(function(){1==t._state&&e.resolve(t.value()),2==t._state&&e.reject(t.rejectReason())})}return 1==this._state&&this.fulfill(this._stateValue),void(2==this._state&&this.reject(this._rejectReason))}if(this.isObject(t)&&t.then&&this.isFunction(t.then)){var i=!1;try{var e=this;t.then.call(t,function(t){i||(e.resolve(t),i=!0)},function(t){i||(e.reject(t),i=!0)})}catch(n){i||this.reject(n)}}else this._state=1,this._stateValue=t,this.fulfill(t)}},t.state=function(t){return"undefined"!=typeof t&&(this._state=t),this._state},t.then=function(t,n){n||(n=function(){});var a=new e(t,n),r=this;return 1==this._state&&i().asap(function(){r.fulfill(r.value())}),2==this._state&&ater().asap(function(){r.reject(r.rejectReason())}),this._childPromises.push(a),a},t.triggerStateChange=function(){var t=this;this._listeners&&(this._listeners.forEach(function(e){e(t)}),this._listeners.length=0)},t.value=function(t){return"undefined"!=typeof t?(this._stateValue=t,this):this._stateValue}}(this)},e=function(t,i,n,a,r,o,s,c){if(!(this instanceof e))return new e(t,i,n,a,r,o,s,c);var f=[t,i,n,a,r,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=e._classInfo.name)return new _(t,i,n,a,r,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};e._classInfo={name:"_promise"},e.prototype=new t,"undefined"!=typeof window&&(window._promise=e),"undefined"!=typeof window&&(window._promise_prototype=t);var i=function(){!function(t){var e,i,n,a,r;t.add=function(t,e,n){if(e||n){var a;"[object Array]"===Object.prototype.toString.call(n)?a=n:(a=Array.prototype.slice.call(arguments,2),a||(a=[])),i.push([e,t,a])}else i.push(t)},t.after=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),a[i]={step:Math.floor(1e3*t),fn:e,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),a[i]={step:Math.floor(1e3*t),fn:e,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!e){this.polyfill();
var t,o;if("undefined"!=typeof window){var t=window.requestAnimationFrame,o=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(e){t||(t=window[e+"RequestAnimationFrame"],o=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),o||(o=function(t){clearTimeout(t)}),i=[],n={},a={},r=[];var s=0,c=function(){for(var e,o=(new Date).getTime();e=i.shift();)"[object Array]"===Object.prototype.toString.call(e)?e[1].apply(e[0],e[2]):e();for(var f=0;f<r.length;f++){var _=r[f];_()}for(var l in n)if(n.hasOwnProperty(l)){var d=n[l];d[0](d[1]),delete n[l]}for(var l in a)if(a.hasOwnProperty(l)){var d=a[l];d.nextTime<o&&(d.remove?d.nextTime>0?(d.fn(),delete a[l]):d.nextTime=o+d.step:(d.fn(),d.nextTime=o+d.step)),d.until&&d.until<o&&delete a[l]}t(c),s=o};c(),e=!0}}),t.once=function(t,e,i){n[t]=[e,i]},t.onFrame=function(t){r.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var e=r.indexOf(t);return e>=0?(t._onRemove&&t._onRemove(),r.splice(e,1),!0):!1}}(this)},n=function(t,e,i,a,r,o,s,c){if(!(this instanceof n))return new n(t,e,i,a,r,o,s,c);var f=[t,e,i,a,r,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=n._classInfo.name)return new _(t,e,i,a,r,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};n._classInfo={name:"later"},n.prototype=new i,"undefined"!=typeof window&&(window.later=n),"undefined"!=typeof window&&(window.later_prototype=i);var a=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var i;t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t,e){return t===!1&&e?void 0:(i||(i={}),i[t]?i[t]:void(i[t]=this))}),t.addCommands=function(t,e){if(this.isArray(t)){var i=this;return t.forEach(function(t){i.addCommands(t)}),this}this._commands.push({fnCmd:t,fnFail:e,async:!0})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){this._commands||(this._commands=[],this.waitingList=[],this._index=0);var i=this;e||n().every(1/30,function(){i.step()})}),t.step=function(){var t=this._index,i=this._commands.length;if(t!=i){for(var n=e(),a=n,r=e(),o=this;i>t;){var s=this._commands[t];!function(t){a=a.then(function(){var i=e();return t.fnCmd(function(){i.resolve(!0)},function(e){i.resolve(!0),t.fnFail&&t.fnFail(e)}),i}).fail(function(e){t.fnFail&&t.fnFail(e)})}(s),this._index++,t++}return a.then(function(){if(o.waitingList.shift(),r.resolve(!0),o.waitingList.length){var t=o.waitingList[0];t.resolve(!0)}}).fail(function(){}),this.waitingList.push(n),1==this.waitingList.length&&n.resolve(!0),r}}}(this)},r=function(t,e,i,n,a,o,s,c){if(!(this instanceof r))return new r(t,e,i,n,a,o,s,c);var f=[t,e,i,n,a,o,s,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=r._classInfo.name)return new _(t,e,i,n,a,o,s,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};r._classInfo={name:"sequenceStepper"},r.prototype=new a,"undefined"!=typeof window&&(window.sequenceStepper=r),"undefined"!=typeof window&&(window.sequenceStepper_prototype=a);var o=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){t.cont=function(t){if(this.isArray(t)){var i=this,n=this._list.slice(this._index+1);if(0==n.length)return void this.step();var a=[];t.forEach(function(t){var e=i._list.slice(i._index+1),n=v(i);i._subStreams.push(n),n.addObserver(e),a.push(n.pushValue(t))});var r=e();r.all(a).then(function(){var t=[];i._subStreams.length=0,a.forEach(function(e){t.push(e.value())}),i.resolve(t)}),r.resolve(!0)}else"undefined"!=typeof t&&(this._context.value=t),this.step()},t.ctxVar=function(t,e){if("undefined"==typeof e){var i=this._contextVars[t];return"undefined"==typeof i&&this._parent?this._parent.ctxVar(t):i}this._contextVars[t]=e},t.get=function(t){if(this._closure){var e=this._contextVars[t];return"undefined"==typeof e?this._parent.get(t):e}var e=this._contextVars[t];return"undefined"==typeof e&&this._parent?this._parent.get(t):e},t.getRest=function(){},t.getState=function(){return this._stopState},t.getValue=function(){return!this._context&&this._parent?this._parent.getValue():this._context&&!this._context.value&&!this._context.initWith&&this._parent?this._parent.getValue():this._context.value||this._context.initWith},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){this._context={},this._contextVars={},this._subStreams=[],this._stopState=0,t&&(this._parent=t),e&&(this._closure=!0)}),t.killAll=function(){this._subStreams&&this._subStreams.forEach(function(t){t.killAll()})},t.run=function(t){if(this._closure){if(this._parent)return void this._parent.run(t);console.error("No parent for closure")}this._stopState=1,this.cont(t)},t.set=function(t,e){if("undefined"!=typeof e){if(this._closure)if("undefined"!=typeof this._contextVars[t])this._contextVars[t]=e;else if(this._parent)return this._parent.set(t,e),this;return"undefined"==typeof this._contextVars[t]&&this._parent?(this._parent.set(t,e),this):(this._contextVars[t]=e,this)}},t.setContext=function(t){this._context=t},t.setParent=function(t){this._parent=t},t.start=function(t){this._list=t,this._index=-1,this.step()},t.step=function(){this._index++;var t=this._index;if(this._list[t]){var e=this._list[t];this.isObject(e)&&!this.isFunction(e)?e.closure?(e.closure.setParent(this),e.fn.apply(e.closure,[e.closure])):e.fn.apply(this,[this]):e.apply(this,[this])}else"undefined"==typeof this._context.value&&(this._context.value=this._context.initWith),this._stopState<2&&(this._stopState=7),this.resolve(this._context.value)},t.stopStream=function(){this._context.value||(this._context.value=this._context.initWith),this._stopState=3,this.resolve(this._context.value)}}(this)};o.prototype=e.prototype;var s=function(t,e,i,n,a,r,o,c){if(!(this instanceof s))return new s(t,e,i,n,a,r,o,c);var f=[t,e,i,n,a,r,o,c];if(this.__factoryClass){var _,l=this;if(this.__factoryClass.forEach(function(t){_=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=s._classInfo.name)return new _(t,e,i,n,a,r,o,c)}else if(_)return _}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};s._classInfo={name:"streamProcessor"},s.prototype=new o,"undefined"!=typeof window&&(window.streamProcessor=s),"undefined"!=typeof window&&(window.streamProcessor_prototype=o),function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var i;t.addObserver=function(t,e){if(this.isArray(t)){var i=this;return void t.forEach(function(t){i.addObserver(t,e)})}return this.isObject(t)&&!this.isFunction(t)?void this._observers.push(t):(this._observers.push({fn:t,closure:e}),this)},t.branch=function(t,e){var i=this,n=(new Date).getTime();return i._lastBranch=n,this.addObserver(function(a){var r=((new Date).getTime(),a.getValue());setTimeout(function(){var o=(new Date).getTime();if(!(e>o-n)){var s=0;(s=i.isActiveRunning())||(a=i.getLastProcess(),3==a.getState()&&(i._lastBranch=o,n=o,t(r)))}},e),a.run()}),this},t.branchIfOk=function(t,e){var i=this,n=(new Date).getTime();return i._lastBranch=n,this.addObserver(function(a){var r=((new Date).getTime(),a.getValue());setTimeout(function(){var o=(new Date).getTime();if(!(e>o-n)){var s=0;(s=i.isActiveRunning())||(a=i.getLastProcess(),7==a.getState()&&(i._lastBranch=o,n=o,t(r)))}},e),a.run()}),this},t.collectValuesFor=function(t){var e=this,i=(new Date).getTime();return e._lastBranch=i,this.addObserver(function(n){(new Date).getTime(),n.getValue();setTimeout(function(){var a=(new Date).getTime();if(!(t>a-i)){var r=e.isActiveRunning(),o=e.getLastProcess();return r>1&&n!=o?void n.stopStream(n.getValue()):void o.run()}},t)}),this},t.combineLatest=function(t){var e=this,i=[],n=t.length,a=function(){for(var t=!0,e=0;n>e;e++)"undefined"==typeof i[e]&&(t=!1);return t};return t.forEach(function(t,n){t.addObserver(function(t){i[n]=t.getValue(),a()&&e.pushValue(i),t.run()})}),this},t.filter=function(t){var e=this;return this.addObserver(function(i){var n=i.getValue(),a=[];return e.isArray(n)?(n.forEach(function(e){t(e)&&a.push(e)}),void(a.length?i.run(a):i.stopStream())):t(n)?void i.run(n):void i.stopStream()}),this},t.forContext=function(t){var e=this;e.addObserver(function(i){var n=i.getValue(),a=[];e.isArray(n)?n.forEach(function(e,n){a.push(t(e,n,i))}):a.push(t(n,0,i)),i.run(n)})},t.forEach=function(t){var e=this;return e.addObserver(function(i){var n=i.getValue(),a=[];e.isArray(n)?n.forEach(function(e){a.push(t(e))}):a.push(t(n)),i.run(n)}),this},t.getLastProcess=function(){var t=this._active.length;return t>0?this._active[t-1]:this._lastProcess},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._childIndex=0,this._childStreams=[],this._values=[],this._active=[],this._lastProcess,this._observers=[],this._id=this.guid(),i||(i={}),i[this._id]=this,t&&(this._parentProcessor=t)}),t.isActiveRunning=function(){return this._active.length},t.killAll=function(){this._active.forEach(function(t){t.killAll(),t.stopStream()})},t.map=function(t){var e=this;return e.addObserver(function(i){var n=i.getValue(),a=[];e.isArray(n)?n.forEach(function(e){a.push(t(e))}):a.push(t(n)),i.run(a)}),this},t.pushValue=function(t){var i=e();return this.startProcess({initWith:t},i),i},t.reduce=function(t,e){var i=this;return i.addObserver(function(n){var a=n.getValue(),r=[];r=i.isArray(a)?a.reduce(t,e):[a].reduce(t,e),n.run(r)}),this},t.startProcess=function(t,e){var i=this._observers.slice(),n=s(this._parentProcessor);n.setContext(t),n.start(i),n._streamPromise=e,this._active.push(n);var a=this;n.then(function(t){var i=a._active.indexOf(n);a._active.splice(i,1),e.resolve(t),a._lastProcess=n})},t.step=function(){}}(this)},v=function(t,e,i,n,a,r,o,s){if(!(this instanceof v))return new v(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=v._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};v._classInfo={name:"simpleStream"},v.prototype=new h,"undefined"!=typeof window&&(window.simpleStream=v),"undefined"!=typeof window&&(window.simpleStream_prototype=h),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},testDataObjects=function(t,e,i,n,a,r,o,s){if(!(this instanceof testDataObjects))return new testDataObjects(t,e,i,n,a,r,o,s);var c=[t,e,i,n,a,r,o,s];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=testDataObjects._classInfo.name)return new f(t,e,i,n,a,r,o,s)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};testDataObjects._classInfo={name:"testDataObjects"},testDataObjects.prototype=new testDataObjects_prototype,"undefined"!=typeof window&&(window.testDataObjects=testDataObjects),"undefined"!=typeof window&&(window.testDataObjects_prototype=testDataObjects_prototype);